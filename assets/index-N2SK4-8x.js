import{r as Da,a as _a,g as qa}from"./react-vendor-CRB3T2We.js";import{r as o,T as Os,R as Gt,a as Te,L as yt,X as ze,F as Pe,S as Lt,b as be,C as ds,P as Vl,c as Ds,G as Fa,d as us,e as _s,f as Va,g as tt,h as Nl,i as it,j as Ya,k as Yl,A as Bl,l as Ul,U as ns,m as is,n as vl,o as kl,M as Ba,E as Cl,p as Ua,q as za,D as Ga,H as Wa,W as Ja,s as Xa,t as Sl,u as Ls,v as $s,w as Il,x as Pl,y as El,z as Ml,B as Tl,I as Ll,J as Ha,K as Ka,N as Qa,O as $l,Q as Za}from"./icons-CAF9ZfLK.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))c(x);new MutationObserver(x=>{for(const f of x)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function i(x){const f={};return x.integrity&&(f.integrity=x.integrity),x.referrerPolicy&&(f.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?f.credentials="include":x.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(x){if(x.ep)return;x.ep=!0;const f=i(x);fetch(x.href,f)}})();var As={exports:{}},Ut={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Al;function er(){if(Al)return Ut;Al=1;var n=Da(),m=Symbol.for("react.element"),i=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,x=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function g(P,L,$){var O,U={},W=null,E=null;$!==void 0&&(W=""+$),L.key!==void 0&&(W=""+L.key),L.ref!==void 0&&(E=L.ref);for(O in L)c.call(L,O)&&!f.hasOwnProperty(O)&&(U[O]=L[O]);if(P&&P.defaultProps)for(O in L=P.defaultProps,L)U[O]===void 0&&(U[O]=L[O]);return{$$typeof:m,type:P,key:W,ref:E,props:U,_owner:x.current}}return Ut.Fragment=i,Ut.jsx=g,Ut.jsxs=g,Ut}var Rl;function tr(){return Rl||(Rl=1,As.exports=er()),As.exports}var e=tr(),cs={},Ol;function sr(){if(Ol)return cs;Ol=1;var n=_a();return cs.createRoot=n.createRoot,cs.hydrateRoot=n.hydrateRoot,cs}var lr=sr();const ar=qa(lr),zt=n=>{const m=new Set,i=new Set;n.forEach(x=>{x.parentId||m.add(x.id)});let c=!0;for(;c;)c=!1,n.forEach(x=>{x.parentId&&!m.has(x.id)&&!i.has(x.id)&&(m.has(x.parentId)?(m.add(x.id),c=!0):i.has(x.parentId)?i.add(x.id):n.some(g=>g.id===x.parentId)||i.add(x.id))});return n.filter(x=>m.has(x.id))},Fe=(n,m)=>{const i=new Set,c=[n];for(;c.length>0;){const x=c.shift();if(x&&!i.has(x)){i.add(x);const f=m.filter(g=>g.parentId===x);for(const g of f)c.push(g.id)}}return i},zl=o.createContext(void 0),rr=({children:n})=>{const[m,i]=o.useState({}),[c,x]=o.useState({}),[f,g]=o.useState(!1),P=()=>{const $={position:"fixed",top:"0",right:"-45vw",width:"40vw",height:"100vh",zIndex:99998,transform:"none"},O={position:"fixed",top:"0",right:"0",width:"40vw",height:"100vh",borderRadius:"0",zIndex:99999,transform:"none"};i($),x(O),g(!0)},L=()=>{i({}),x({}),g(!1)};return e.jsx(zl.Provider,{value:{controlPanelModalStyle:m,itemManagementModalStyle:c,isRepositioned:f,repositionModalsForPreview:P,resetModalPositions:L},children:n})},qs=()=>{const n=o.useContext(zl);if(n===void 0)throw new Error("useModalPositions must be used within a ModalPositionProvider");return n},or="VideoStationDB",nr=2,X={REPOSITORY:"repository",PLAYLIST:"playlist",CATEGORIES:"categories",SETTINGS:"settings",SAVED_PLAYLISTS:"savedPlaylists"},ct={MAIN_REPOSITORY:"main_repository",MAIN_PLAYLIST:"main_playlist",USER_CATEGORIES:"user_categories",USER_SETTINGS:"user_settings"},Wt=()=>new Promise((n,m)=>{const i=indexedDB.open(or,nr);i.onerror=c=>{console.error("Database error:",c.target.error),m(c.target.error)},i.onsuccess=c=>{n(c.target.result)},i.onupgradeneeded=c=>{const x=c.target.result;c.target.transaction,x.objectStoreNames.contains(X.REPOSITORY)||x.createObjectStore(X.REPOSITORY),x.objectStoreNames.contains(X.PLAYLIST)||x.createObjectStore(X.PLAYLIST),x.objectStoreNames.contains(X.CATEGORIES)||x.createObjectStore(X.CATEGORIES),x.objectStoreNames.contains(X.SETTINGS)||x.createObjectStore(X.SETTINGS),x.objectStoreNames.contains(X.SAVED_PLAYLISTS)||x.createObjectStore(X.SAVED_PLAYLISTS,{keyPath:"id"}),c.oldVersion<2&&console.log("Database upgraded to version 2.")}}),xs=async(n,m,i)=>{const c=await Wt();return new Promise((x,f)=>{const L=c.transaction([n],"readwrite").objectStore(n).put(m,i);L.onsuccess=()=>x(),L.onerror=()=>{console.error(`Error saving to ${n}:`,L.error),f(L.error)}})},ms=async(n,m)=>{const i=await Wt();return new Promise((c,x)=>{const P=i.transaction([n],"readonly").objectStore(n).get(m);P.onsuccess=()=>{c(P.result||null)},P.onerror=()=>{console.error(`Error loading from ${n}:`,P.error),x(P.error)}})},Fs=n=>xs(X.REPOSITORY,n,ct.MAIN_REPOSITORY),Gl=()=>ms(X.REPOSITORY,ct.MAIN_REPOSITORY),Wl=n=>xs(X.PLAYLIST,n,ct.MAIN_PLAYLIST),ir=()=>ms(X.PLAYLIST,ct.MAIN_PLAYLIST),Jl=n=>xs(X.CATEGORIES,n,ct.USER_CATEGORIES),cr=()=>ms(X.CATEGORIES,ct.USER_CATEGORIES),Vs=n=>xs(X.SETTINGS,n,ct.USER_SETTINGS),dr=()=>ms(X.SETTINGS,ct.USER_SETTINGS),Dl=async n=>{const m=await Wt();return new Promise((i,c)=>{const g=m.transaction([X.SAVED_PLAYLISTS],"readwrite").objectStore(X.SAVED_PLAYLISTS).put(n);g.onsuccess=()=>i(),g.onerror=()=>c(g.error)})},ur=async()=>{const n=await Wt();return new Promise((m,i)=>{const f=n.transaction([X.SAVED_PLAYLISTS],"readonly").objectStore(X.SAVED_PLAYLISTS).getAll();f.onsuccess=()=>m(f.result||[]),f.onerror=()=>i(f.error)})},xr=async n=>{const m=await Wt();return new Promise((i,c)=>{const g=m.transaction([X.SAVED_PLAYLISTS],"readwrite").objectStore(X.SAVED_PLAYLISTS).delete(n);g.onsuccess=()=>i(),g.onerror=()=>c(g.error)})},mr=async()=>{const[n,m,i,c]=await Promise.all([Gl(),ir(),cr(),dr()]);return{repository:n,playlist:m,categories:i,settings:c}},hr=async n=>{const m=[];n.repository!==void 0&&m.push(Fs(n.repository)),n.playlist!==void 0&&m.push(Wl(n.playlist)),n.categories!==void 0&&m.push(Jl(n.categories)),n.settings!==void 0&&m.push(Vs(n.settings)),await Promise.all(m)},pr=async n=>{const m=await Gl()||[],i=new Map;m.forEach(x=>i.set(x.id,x)),n.forEach(x=>{const f=i.get(x.id);f?x.timestamp>f.timestamp&&i.set(x.id,x):i.set(x.id,x)});const c=Array.from(i.values());return await new Promise(x=>setTimeout(x,50)),await Fs(c),c},br={error:"#ef4444"},st={info:(n,...m)=>{},warn:(n,...m)=>{},error:(n,...m)=>{console.error(`%c❌ ${n}`,`color: ${br.error}; font-weight: bold;`,...m)},debug:(n,...m)=>{},success:(n,...m)=>{},progress:(n,m,i,...c)=>{}};async function fr(){try{const n=await fetch("./video-station-data.json");if(!n.ok)return st.warn("Failed to fetch video-station-data.json"),null;const m=await n.text(),i=JSON.parse(m);return i.version==="2.0"&&i.quickLoad?(st.success("Loaded new format data (v2.0)"),i):(st.warn("Legacy format detected, converting..."),Xl(i))}catch(n){return st.error("Failed to load quick data:",n),null}}function Xl(n){const m=n.repository||[],i=n.categories||[],c=n.playlist||[],x=n.settings||{},f=new Map;m.forEach(L=>{const $=L.categoryId||"default";f.has($)||f.set($,[]),f.get($).push(L)});const g=[],P=[];return f.forEach(L=>{const $=L.slice(0,200),O=L.slice(200);g.push(...$),P.push(...O)}),{version:"2.0",metadata:{totalItems:m.length,quickLoadItems:g.length,fullLoadItems:P.length,lastUpdated:new Date().toISOString(),categories:i.length},quickLoad:{categories:i,settings:x,playlist:c,repository:g},fullLoad:{repository:P}}}async function gr(n,m){try{const i=await fetch("./video-station-data.json");if(!i.ok)throw new Error("Failed to fetch data");const c=await i.text(),x=JSON.parse(c);let f;x.version==="2.0"&&x.fullLoad?f=x:f=Xl(x);const g=f.fullLoad.repository,P=g.length;if(P===0)return st.success("No additional data to load"),[];st.info(`Starting background load of ${P} items...`);const $=wr(g,100),O=[];for(let U=0;U<$.length;U++){await ql(100);const W=$[U];O.push(...W),n&&n(O.length,P),st.progress("Loaded chunk",U+1,$.length),(U+1)%5===0&&await ql(200)}return st.success("Background loading completed!"),O}catch(i){return st.error("Background loading failed:",i),[]}}function Rs(n,m){const i=new Map;return n.forEach(c=>i.set(c.id,c)),m.forEach(c=>{const x=i.get(c.id);x&&c.timestamp&&x.timestamp?c.timestamp>x.timestamp&&i.set(c.id,c):i.set(c.id,c)}),Array.from(i.values())}function _l(n,m){return{repository:Rs((n==null?void 0:n.repository)||[],(m==null?void 0:m.repository)||[]),categories:Rs((n==null?void 0:n.categories)||[],(m==null?void 0:m.categories)||[]),playlist:Rs((n==null?void 0:n.playlist)||[],(m==null?void 0:m.playlist)||[]),settings:{...n==null?void 0:n.settings,...m==null?void 0:m.settings}}}function yr(n){const m=new Map;n.repository.forEach(x=>{const f=x.categoryId||"default";m.has(f)||m.set(f,[]),m.get(f).push(x)});const i=[],c=[];return m.forEach(x=>{const f=x.slice(0,200),g=x.slice(200);i.push(...f),c.push(...g)}),{version:"2.0",metadata:{totalItems:n.repository.length,quickLoadItems:i.length,fullLoadItems:c.length,lastUpdated:new Date().toISOString(),categories:n.categories.length},quickLoad:{categories:n.categories,settings:n.settings,playlist:n.playlist,repository:i},fullLoad:{repository:c}}}function wr(n,m){const i=[];for(let c=0;c<n.length;c+=m)i.push(n.slice(c,c+m));return i}function ql(n){return new Promise(m=>setTimeout(m,n))}class jr extends o.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(m){return{hasError:!0,error:m}}componentDidCatch(m,i){console.error("Uncaught error:",m,i)}render(){var m;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-slate-900 text-slate-200 p-8 text-center",children:[e.jsx(Os,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"عذراً، حدث خطأ غير متوقع"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-lg",children:((m=this.state.error)==null?void 0:m.message)||"حدث خطأ أثناء عرض هذا العنصر."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition-all",children:[e.jsx(Gt,{className:"w-4 h-4"}),"إعادة تحميل التطبيق"]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-lg font-bold transition-all",children:"محاولة الاستمرار"})]})]}):this.props.children}}const Nr=({isOpen:n,onClose:m,repository:i,setRepository:c,categories:x,settings:f,setSettings:g,handleDeleteItems:P,handleMoveItems:L,handlePreviewItem:$,handleEditVideo:O,setEditingVideo:U,setShowEditModal:W,initialSelectedItems:E,setInitialSelectedItems:re})=>{const[fe,Ge]=o.useState(null),[A,ne]=o.useState([]),[hs,Le]=o.useState(!1),[$e,ve]=o.useState(""),[dt,Ve]=o.useState(!1),[me,ut]=o.useState(""),[ce,We]=o.useState(-1),[te,se]=o.useState(-1),ke=o.useRef(null);o.useEffect(()=>{n?(ne(E),re(E),E.length>0?Ve(!0):Ve(!1),ve(""),Le(!1),We(-1),se(-1)):(re([]),ne([]))},[n,E,re]);const H=h=>{typeof h=="function"?ne(y=>{const D=h(y);return re(D),D}):(ne(h),re(h))},[Ee,wt]=o.useState(!1),[_e,jt]=o.useState([]),[ge,Z]=o.useState("websites"),[oe,$t]=o.useState({x:0,y:0}),[Ae,lt]=o.useState(!1),[Je,Me]=o.useState({x:0,y:0}),{itemManagementModalStyle:Xe,isRepositioned:de,resetModalPositions:Nt}=qs();o.useEffect(()=>{n||Nt()},[n,Nt]);const vt=h=>{lt(!0),Me({x:h.clientX-oe.x,y:h.clientY-oe.y})},at=Te.useCallback(h=>{Ae&&$t({x:h.clientX-Je.x,y:h.clientY-Je.y})},[Ae,Je]),He=Te.useCallback(()=>{lt(!1)},[]);Te.useEffect(()=>(Ae?(document.addEventListener("mousemove",at),document.addEventListener("mouseup",He)):(document.removeEventListener("mousemove",at),document.removeEventListener("mouseup",He)),()=>{document.removeEventListener("mousemove",at),document.removeEventListener("mouseup",He)}),[Ae,at,He]);const xt=o.useMemo(()=>x.filter(h=>h.type==="websites"),[x]),Ke=o.useMemo(()=>x.filter(h=>h.type==="elements"),[x]),Y=o.useMemo(()=>{if(!fe)return[];const h=i.filter(y=>y.categoryId===fe&&(me===""||y.url.toLowerCase().includes(me.toLowerCase())));switch(f.itemsSortOrder){case"newest":return h.sort((y,D)=>D.timestamp-y.timestamp);case"oldest":return h.sort((y,D)=>y.timestamp-D.timestamp);case"alphabetical":return h.sort((y,D)=>y.title.localeCompare(D.title));case"random":return h.sort(()=>.5-Math.random());default:return h.sort((y,D)=>y.title.localeCompare(D.title))}},[i,fe,me,f.itemsSortOrder]);o.useEffect(()=>{We(-1),H([]),Le(!1),se(-1)},[fe,me]),o.useEffect(()=>{if(!n||!ke.current)return;const h=y=>{const D=ke.current;if(!D)return;const z=Y,B=z.length;if(B===0)return;let K=ce,k=!1;if(y.key==="ArrowDown")K=Math.min(ce+1,B-1),k=!0;else if(y.key==="ArrowUp")K=Math.max(ce-1,0),k=!0;else if(y.key===" "){if(ce!==-1){const _=z[ce].id;H(G=>G.includes(_)?G.filter(le=>le!==_):[...G,_]),se(ce)}k=!0}else y.key==="a"&&(y.ctrlKey||y.metaKey)&&(A.length===B?(H([]),Le(!1)):(H(z.map(_=>_.id)),Le(!0)),k=!0);if(k&&(y.preventDefault(),y.stopPropagation()),K!==ce){We(K);const _=D.children[K];_&&_.scrollIntoView({behavior:"smooth",block:"nearest"})}if(y.shiftKey&&(y.key==="ArrowUp"||y.key==="ArrowDown"))if(te===-1)H(_=>{const G=z[ce].id;return _.includes(G)?_:[..._,G]}),se(ce);else{const _=Math.min(te,K),G=Math.max(te,K);z.slice(_,G+1).map(le=>le.id),H(le=>{const ue=new Set(le);if(y.key==="ArrowDown")for(let ae=te;ae<=K;ae++)ue.add(z[ae].id);else for(let ae=K;ae<=te;ae++)ue.add(z[ae].id);return Array.from(ue)})}};return ke.current.focus(),ke.current.addEventListener("keydown",h),()=>{var y;(y=ke.current)==null||y.removeEventListener("keydown",h)}},[n,ce,Y,A,te]),o.useEffect(()=>{dt||ve("")},[dt]),o.useEffect(()=>{n&&(Ve(!1),ve(""))},[n]);const Re=h=>{const y=new Map;return h.forEach(D=>{try{const B=new URL(D.url).hostname;y.has(B)||y.set(B,[]),y.get(B).push(D)}catch{const B="Other";y.has(B)||y.set(B,[]),y.get(B).push(D)}}),y};return n?e.jsx("div",{className:de?"z-[201]":"fixed inset-0 bg-black/80 backdrop-blur-sm z-[201] flex items-center justify-center p-6",style:de?Xe:{...Xe,transform:`translate(${oe.x}px, ${oe.y}px)`},children:e.jsxs("div",{className:`bg-slate-900 border border-slate-700 w-full max-w-6xl ${de?"h-full rounded-none":"h-[90vh] rounded-2xl"} shadow-2xl flex flex-col overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-950/80",onMouseDown:vt,children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(yt,{className:"text-cyan-500"})," إدارة العناصر"]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(ze,{className:"w-5 h-5 text-slate-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-900 text-slate-200",children:e.jsxs("div",{className:`grid ${de?"grid-cols-1":"grid-cols-3"} gap-6 h-full relative`,children:[e.jsxs("div",{className:`${de?"hidden":"col-span-1"} border-l border-slate-800 p-2 overflow-y-auto`,children:[e.jsx("h3",{className:"font-bold text-slate-300 mb-4 sticky top-0 bg-slate-900 pb-2 border-b border-slate-800",children:"الأقسام"}),e.jsx("div",{className:"space-y-1",children:x.map(h=>e.jsxs("button",{onClick:()=>{Ge(h.id),ne([]),Le(!1)},className:`w-full flex items-center justify-between p-3 rounded-lg text-sm transition-colors ${fe===h.id?"bg-cyan-900/30 text-cyan-400 border border-cyan-900/50":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),h.name]}),e.jsx("span",{className:"text-[10px] bg-slate-800 px-2 py-0.5 rounded-full",children:i.filter(y=>y.categoryId===h.id).length})]},h.id))})]}),e.jsx("div",{className:`${de?"col-span-1":"col-span-2"} flex flex-col h-full overflow-hidden`,children:fe?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-2 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:A.length===Y.length&&Y.length>0,onChange:h=>{const y=h.target.checked;Le(y),H(y?Y.map(D=>D.id):[])},className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-300",children:A.length>0?`تم تحديد ${A.length} عنصر`:"تحديد الكل"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>wt(!Ee),className:`px-3 py-1.5 rounded text-xs flex items-center gap-1 transition-colors ${Ee?"bg-indigo-600 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,title:"تجميع حسب الموقع",children:[e.jsx(Pe,{className:"w-3 h-3"}),Ee?"عرض القائمة":"تجميع حسب الموقع"]}),e.jsx("input",{type:"text",placeholder:"تصفية حسب الرابط...",value:me,onChange:h=>ut(h.target.value),className:"bg-slate-800 border border-slate-700 rounded-lg p-1.5 text-xs text-white placeholder-slate-500"}),A.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{i.filter(y=>A.includes(y.id)).forEach(y=>$(y))},className:"px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded text-xs flex items-center gap-1",children:[e.jsx(Lt,{className:"w-3 h-3"})," معاينة"]}),e.jsxs("button",{onClick:()=>Ve(!0),className:"px-3 py-1.5 bg-blue-900/30 hover:bg-blue-900/50 text-blue-400 rounded text-xs flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"})," نقل"]}),e.jsxs("button",{onClick:()=>{P(A),ne([]),Le(!1)},className:"px-3 py-1.5 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded text-xs flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," حذف"]})]})]})]}),e.jsx("div",{ref:ke,tabIndex:0,className:"flex-1 overflow-y-auto space-y-2 pr-2 outline-none focus:ring-2 focus:ring-cyan-500 rounded-lg",children:Y.length>0?Ee?Array.from(Re(Y).entries()).sort(([,h],[,y])=>y.length-h.length).map(([h,y],D)=>{const z=_e.includes(h),B=y.every(k=>A.includes(k.id)),K=()=>{const k=y.map(_=>_.id);H(B?_=>_.filter(G=>!k.includes(G)):_=>Array.from(new Set([..._,...k])))};return e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-2 border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer p-2",onClick:()=>jt(k=>k.includes(h)?k.filter(_=>_!==h):[...k,h]),children:[e.jsx("input",{type:"checkbox",checked:B,onChange:K,onClick:k=>k.stopPropagation(),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-indigo-500 focus:ring-indigo-500"}),e.jsxs("span",{className:"text-sm font-mono text-slate-500 w-8 text-right pr-2",children:[D+1,"."]}),e.jsx(ds,{className:`w-4 h-4 transition-transform duration-200 ${z?"rotate-90":""}`}),e.jsx("span",{className:"font-bold text-slate-300",children:h}),e.jsx("span",{className:"text-xs text-slate-500 bg-slate-700 px-2 py-0.5 rounded-full",children:y.length})]}),z&&e.jsx("div",{className:"pl-8 pt-2 space-y-1",children:y.map(k=>{const _=A.includes(k.id);return e.jsxs("div",{className:"flex items-center justify-between gap-2 group",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:()=>{H(_?G=>G.filter(le=>le!==k.id):G=>[...G,k.id])},className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-indigo-500 focus:ring-indigo-500"}),e.jsx("p",{className:"text-sm text-slate-400 truncate cursor-pointer hover:text-indigo-300",title:k.title,onClick:()=>$(k),children:k.title})]}),e.jsx("button",{onClick:()=>$(k),className:"p-1 text-slate-500 hover:text-green-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"معاينة",children:e.jsx(Lt,{className:"w-4 h-4"})})]},k.id)})})]},h)}):Y.map((h,y)=>{const D=y===ce,z=A.includes(h.id),B=K=>{if(We(y),K.shiftKey&&te!==-1){const k=Math.min(te,y),_=Math.max(te,y),G=Y.slice(k,_+1).map(le=>le.id);H(le=>{const ue=new Set(le);return G.forEach(ae=>{ue.has(ae)?ue.delete(ae):ue.add(ae)}),Array.from(ue)})}else H(z?k=>k.filter(_=>_!==h.id):k=>[...k,h.id]),se(y)};return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer
                                      ${z?"bg-cyan-900/10 border-cyan-900/50":"bg-slate-800/40 border-slate-800 hover:bg-slate-800"}
                                      ${D?"ring-2 ring-blue-500 ring-offset-2 ring-offset-slate-900":""}`,onClick:B,children:[e.jsx("input",{type:"checkbox",checked:z,onChange:K=>{K.target.checked?ne(_=>[..._,h.id]):(ne(_=>_.filter(G=>G!==h.id)),Le(!1))},className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-slate-300 truncate",children:h.title}),e.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:h.url})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>$(h),className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-green-400",title:"معاينة",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{U(h),W(!0)},className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-blue-400",title:"تعديل",children:e.jsx(Vl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{ne([h.id]),Ve(!0)},className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-yellow-400",title:"نقل",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P([h.id]),className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-red-400",title:"حذف",children:e.jsx(be,{className:"w-4 h-4"})})]})]},h.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(Pe,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"هذا القسم فارغ"})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(yt,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg",children:"اختر قسماً لعرض محتوياته"})]})}),dt&&e.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-50 rounded-lg",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-6 rounded-xl w-96 shadow-2xl",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"نقل العناصر المحددة"}),e.jsxs("p",{className:"text-sm text-slate-400 mb-4",children:["سيتم نقل ",A.length," عنصر إلى القسم المحدد."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>{ve(""),Z("websites")},className:`flex-1 px-3 py-1.5 text-xs font-bold rounded transition-colors ${ge==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>{ve(""),Z("elements")},className:`flex-1 px-3 py-1.5 text-xs font-bold rounded transition-colors ${ge==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),ge==="websites"&&xt.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2",children:"أقسام المواقع"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded p-2 text-white",value:$e,onChange:h=>ve(h.target.value),children:[e.jsx("option",{value:"",children:"اختر قسماً للمواقع..."}),xt.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),ge==="elements"&&Ke.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2",children:"أقسام العناصر"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded p-2 text-white",value:$e,onChange:h=>ve(h.target.value),children:[e.jsx("option",{value:"",children:"اختر قسماً للعناصر..."}),Ke.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),ge==="websites"&&xt.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center",children:"لا توجد أقسام مواقع متاحة للنقل."}),ge==="elements"&&Ke.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center",children:"لا توجد أقسام عناصر متاحة للنقل."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:()=>{Ve(!1),ve("")},className:"px-4 py-2 text-slate-400 hover:text-white",children:"إلغاء"}),e.jsx("button",{onClick:()=>{$e?(L(A,$e),Ve(!1),ne([]),Le(!1),ve("")):alert("الرجاء اختيار قسم")},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold",children:"نقل"})]})]})})]})})]})}):null},vr=({isOpen:n,onClose:m,settings:i,setSettings:c,playlist:x,setPlaylist:f,quickList:g,setQuickList:P,playbackTarget:L,setPlaybackTarget:$,setCurrentIndex:O,repository:U,setRepository:W,categories:E,savedPlaylists:re,saveCurrentAsPlaylist:fe,deleteSavedPlaylist:Ge,viewMode:A,setViewMode:ne,loadSavedPlaylist:hs,clearPlaylist:Le,addCategory:$e,renameCategory:ve,deleteCategoryRecursive:dt,handleCatDragStart:Ve,handleCatDragOver:me,handleCatDrop:ut,handleReorderCategories:ce,handleDeleteItems:We,handleMoveItems:te,handlePreviewItem:se,handleEditVideo:ke,setEditingVideo:H,setShowEditModal:Ee,showItemManagementModal:wt,setShowItemManagementModal:_e,initialSelectedItems:jt,setInitialSelectedItems:ge})=>{var Qt;const[Z,oe]=o.useState("display"),[$t,Ae]=o.useState(null),[lt,Je]=o.useState(""),[Me,Xe]=o.useState(""),[de,Nt]=o.useState("websites"),[vt,at]=o.useState(""),[He,xt]=o.useState("websites"),[Ke,Y]=o.useState("websites"),[Re,h]=o.useState("websites"),y=E.filter(r=>r.type==="websites"),D=E.filter(r=>r.type==="elements"),z=E.filter(r=>r.type===He&&!r.parentId).sort((r,p)=>(r.order??0)-(p.order??0)),[B,K]=o.useState(null),[k,_]=o.useState({x:0,y:0}),[G,le]=o.useState(!1),[ue,ae]=o.useState({x:0,y:0}),{controlPanelModalStyle:mt,isRepositioned:ht,resetModalPositions:kt}=qs();Te.useEffect(()=>{n||kt()},[n,kt]);const At=r=>{le(!0),ae({x:r.clientX-k.x,y:r.clientY-k.y})},Ct=Te.useCallback(r=>{G&&_({x:r.clientX-ue.x,y:r.clientY-ue.y})},[G,ue]),St=Te.useCallback(()=>{le(!1)},[]);Te.useEffect(()=>(G?(document.addEventListener("mousemove",Ct),document.addEventListener("mouseup",St)):(document.removeEventListener("mousemove",Ct),document.removeEventListener("mouseup",St)),()=>{document.removeEventListener("mousemove",Ct),document.removeEventListener("mouseup",St)}),[G,Ct,St]);const[ps,Jt]=o.useState([]),Ce=({category:r,allCategories:p,level:j,editingCategory:R,editName:M,handleEditCategory:N,renameCategory:C,deleteCategoryRecursive:V,handleDragStart:xe,handleDragOver:Ze,handleDrop:bt,handleDragEnd:he,draggedCategory:Ye,handleSetExpandedCategories:Bs,orderNumberChangeHandler:fs})=>{var ot;const Zt=ps.includes(r.id),qt=p.filter(J=>J.parentId===r.id).sort((J,pe)=>(J.order??0)-(pe.order??0)),[q,Be]=o.useState(!1),[Ft,ft]=o.useState(r.order??0);Te.useEffect(()=>{ft(r.order??0)},[r.order]);const gs=J=>{J.stopPropagation(),Jt(pe=>pe.includes(r.id)?pe.filter(Oe=>Oe!==r.id):[...pe,r.id])},Et=J=>{const pe=parseInt(J.target.value,10);isNaN(pe)||ft(pe)},Mt=()=>{fs(r.id,Ft),Be(!1)};return e.jsxs("div",{className:`space-y-1 ${j>0?"border-l border-slate-700/50 ml-4 pl-4":""}`,children:[e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group ${(Ye==null?void 0:Ye.id)===r.id?"opacity-50":""}`,draggable:"true",onDragStart:J=>xe(J,r),onDragOver:Ze,onDrop:J=>bt(J,r),onDragEnd:he,style:{paddingLeft:`${j*1}rem`},children:[qt.length>0&&e.jsx("button",{onClick:gs,className:"text-slate-400 hover:text-blue-400",children:Zt?e.jsx(ze,{size:16}):e.jsx(Pe,{size:16})}),e.jsx(Pe,{className:"w-5 h-5 text-orange-400"}),R===r.id?e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{value:M,onChange:J=>Je(J.target.value),className:"flex-1 bg-slate-950 border border-slate-600 rounded px-2 py-1 text-xs",autoFocus:!0,onKeyDown:J=>J.key==="Enter"&&C(r.id,M)}),e.jsx("button",{onClick:()=>C(r.id,M),className:"text-green-400",children:e.jsx(ds,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ae(null),className:"text-red-400",children:e.jsx(ze,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-bold ${r.parentId?"text-sm text-yellow-400":"text-md text-blue-300"}`,children:r.name}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[r.parentId?`(فرعي من: ${(ot=p.find(J=>J.id===r.parentId))==null?void 0:ot.name})`:"(رئيسي)"," • ",U.filter(J=>J.categoryId===r.id).length," فيديو"]})]}),q?e.jsx("input",{type:"number",value:Ft,onChange:Et,onBlur:Mt,onKeyDown:J=>{J.key==="Enter"&&Mt()},className:"w-12 bg-slate-950 border border-slate-600 rounded px-1 py-0.5 text-xs text-center",autoFocus:!0}):e.jsxs("span",{onClick:()=>Be(!0),className:"text-xs text-slate-400 px-2 py-1 rounded cursor-pointer hover:bg-slate-700",children:["Order: ",r.order??0]}),r.id!=="default"&&e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>N(r),className:"p-1.5 hover:bg-slate-700 rounded text-slate-400 hover:text-blue-400",children:e.jsx(Vl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>V(r.id),className:"p-1.5 hover:bg-slate-700 rounded text-slate-400 hover:text-red-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]})]},r.id),Zt&&qt.length>0&&e.jsx("div",{className:"mt-1",children:qt.map(J=>e.jsx(Ce,{category:J,allCategories:p,level:j+1,editingCategory:R,editName:M,handleEditCategory:N,renameCategory:C,deleteCategoryRecursive:V,handleDragStart:xe,handleDragOver:Ze,handleDrop:bt,handleDragEnd:he,draggedCategory:Ye,handleSetExpandedCategories:Bs,orderNumberChangeHandler:fs},J.id))})]})},[qe,ye]=o.useState(null),[Rt,Ot]=o.useState(new Map),[rt,we]=o.useState([]),[It,Dt]=o.useState([]),Pt=o.useCallback(r=>{Jt(p=>p.includes(r)?p.filter(j=>j!==r):[...p,r])},[]),bs=o.useCallback((r,p)=>{const j=E.find(C=>C.id===r);if(!j)return;let R=E.map(C=>({...C}));R=R.map(C=>C.id===r?{...C,order:p}:C);const N=R.filter(C=>C.type===j.type&&C.parentId===j.parentId).sort((C,V)=>(C.order??0)!==(V.order??0)?(C.order??0)-(V.order??0):C.name.localeCompare(V.name));ce(N)},[ce,E]),_t=(r,p)=>{K(p),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",p.id)},Xt=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move"},Ht=(r,p)=>{if(r.preventDefault(),!B||B.id===p.id)return;const j=z,R=j.findIndex(V=>V.id===B.id),M=j.findIndex(V=>V.id===p.id);if(R===-1||M===-1){console.error("Dragged or target category not found in current list.");return}const N=Array.from(j),[C]=N.splice(R,1);N.splice(M,0,C),ce(N),K(null)},Qe=()=>{K(null)};Te.useEffect(()=>{if(Z!=="filtering"||!qe){Ot(new Map),Dt([]),we([]);return}const r=U.filter(j=>j.categoryId===qe),p=new Map;r.forEach(j=>{try{const R=new URL(j.url).hostname.replace(/^www\./,""),M=p.get(R)||[];p.set(R,[...M,j])}catch{const M="Invalid URL",N=p.get(M)||[];p.set(M,[...N,j])}}),Ot(p),we([]),Dt([])},[qe,U,Z]);const Kt=r=>{Ae(r.id),Je(r.name)},pt=r=>{const p={...i,...r};c(p),Vs(p)},Ys=()=>{const r=new Set,p=U.filter(j=>r.has(j.url)?!1:(r.add(j.url),!0));p.length<U.length?confirm(`تم العثور على ${U.length-p.length} فيديو مكرر. هل تريد حذفهم؟`)&&(W(p),alert("تم حذف الفيديوهات المكررة.")):alert("لا توجد فيديوهات مكررة.")};return e.jsxs("div",{className:ht?"z-[200]":"fixed inset-0 bg-black/80 backdrop-blur-sm z-[200] flex items-center justify-center p-6",style:ht?mt:{...mt,transform:`translate(${k.x}px, ${k.y}px)`},children:[e.jsxs("div",{className:`bg-slate-900 border border-slate-700 w-full max-w-6xl ${ht?"h-full rounded-none":"h-[90vh] rounded-2xl"} shadow-2xl flex flex-col overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-950/80",onMouseDown:At,children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ds,{className:"text-blue-500"})," لوحة التحكم"]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(ze,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"flex border-b border-slate-800 bg-slate-900/50 flex-wrap",children:[e.jsxs("button",{onClick:()=>oe("display"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="display"?"text-teal-400 border-b-2 border-teal-400 bg-teal-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Fa,{className:"w-4 h-4"})," العرض"]}),e.jsxs("button",{onClick:()=>oe("quickList"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="quickList"?"text-green-400 border-b-2 border-green-400 bg-green-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(us,{className:"w-4 h-4"})," القائمة السريعة (",g.length,")"]}),e.jsxs("button",{onClick:()=>oe("playlist"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="playlist"?"text-blue-400 border-b-2 border-blue-400 bg-blue-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Lt,{className:"w-4 h-4"})," قائمة التشغيل (",x.length,")"]}),e.jsxs("button",{onClick:()=>oe("savedPlaylists"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="savedPlaylists"?"text-purple-400 border-b-2 border-purple-400 bg-purple-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(_s,{className:"w-4 h-4"})," القوائم المحفوظة (",re.length,")"]}),e.jsxs("button",{onClick:()=>oe("categories"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="categories"?"text-orange-400 border-b-2 border-orange-400 bg-orange-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Pe,{className:"w-4 h-4"})," إدارة الأقسام (",E.length,")"]}),e.jsxs("button",{onClick:()=>_e(!0),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="items"?"text-cyan-400 border-b-2 border-cyan-400 bg-cyan-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(yt,{className:"w-4 h-4"})," إدارة العناصر"]}),e.jsxs("button",{onClick:()=>oe("maintenance"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${Z==="maintenance"?"text-yellow-400 border-b-2 border-yellow-400 bg-yellow-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Os,{className:"w-4 h-4"})," صيانة"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-900 text-slate-200",children:[Z==="filtering"&&e.jsxs("div",{className:"grid grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"col-span-1 border-l border-slate-800 p-2 overflow-y-auto",children:[e.jsx("h3",{className:"font-bold text-slate-300 mb-4 sticky top-0 bg-slate-900 pb-2 border-b border-slate-800",children:"الأقسام"}),e.jsx("div",{className:"space-y-1",children:E.map(r=>e.jsxs("button",{onClick:()=>ye(r.id),className:`w-full flex items-center justify-between p-3 rounded-lg text-sm transition-colors ${qe===r.id?"bg-indigo-900/30 text-indigo-400 border border-indigo-900/50":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),r.name]}),e.jsx("span",{className:"text-[10px] bg-slate-800 px-2 py-0.5 rounded-full",children:U.filter(p=>p.categoryId===r.id).length})]},r.id))})]}),e.jsx("div",{className:"col-span-2 flex flex-col h-full overflow-hidden",children:qe?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-indigo-400",children:["مجمّع حسب الموقع في: ",(Qt=E.find(r=>r.id===qe))==null?void 0:Qt.name]}),rt.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-300",children:`تم تحديد ${rt.length} عنصر`}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),te(rt,qe||""),we([])},className:"px-3 py-1.5 bg-blue-900/30 hover:bg-blue-900/50 text-blue-400 rounded text-xs flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"})," نقل"]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),We(rt),we([])},className:"px-3 py-1.5 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded text-xs flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," حذف"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2",children:Array.from(Rt.entries()).map(([r,p])=>{const j=It.includes(r),R=p.every(N=>rt.includes(N.id)),M=()=>{const N=p.map(C=>C.id);we(R?C=>C.filter(V=>!N.includes(V)):C=>[...new Set([...C,...N])])};return e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-2 border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer p-2",onClick:()=>Dt(N=>N.includes(r)?N.filter(C=>C!==r):[...N,r]),children:[e.jsx("input",{type:"checkbox",checked:R,onChange:M,onClick:N=>N.stopPropagation(),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-indigo-500 focus:ring-indigo-500"}),e.jsx(ds,{className:`w-4 h-4 transition-transform duration-200 ${j?"rotate-90":""}`}),e.jsx("span",{className:"font-bold text-slate-300",children:r}),e.jsx("span",{className:"text-xs text-slate-500 bg-slate-700 px-2 py-0.5 rounded-full",children:p.length})]}),j&&e.jsx("div",{className:"pl-8 pt-2 space-y-1",children:p.map(N=>{const C=rt.includes(N.id);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:()=>{we(C?V=>V.filter(xe=>xe!==N.id):V=>[...V,N.id])},className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-indigo-500 focus:ring-indigo-500"}),e.jsx("p",{className:"text-sm text-slate-400 truncate",title:N.title,children:N.title})]},N.id)})})]},r)})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(Va,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg",children:"اختر قسماً لبدء التصفية"})]})})]}),Z==="display"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات عرض المستودع"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"طريقة عرض العناصر"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"viewMode",value:"list",checked:A==="list",onChange:()=>ne("list")}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"قائمة (العرض الافتراضي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"viewMode",value:"grid",checked:A==="grid",onChange:()=>ne("grid")}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"شبكة (عرض الصور)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"ترتيب العناصر داخل الأقسام"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"manual",checked:i.itemsSortOrder==="manual"||!i.itemsSortOrder,onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"يدوي"})]}),e.jsx("p",{className:"text-xs text-slate-500 -mt-1 ml-6",children:"يتم تفعيله عند تحريك عنصر للأعلى."}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"newest",checked:i.itemsSortOrder==="newest",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"الأحدث"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"oldest",checked:i.itemsSortOrder==="oldest",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"الأقدم"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"alphabetical",checked:i.itemsSortOrder==="alphabetical",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"أبجدي"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"random",checked:i.itemsSortOrder==="random",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عشوائي"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"وضع العرض"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"اختر وضع العرض"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"displayMode",value:"full",checked:i.displayMode==="full"||!i.displayMode,onChange:()=>pt({displayMode:"full"})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"العرض الكامل (الافتراضي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"displayMode",value:"family",checked:i.displayMode==="family",onChange:()=>pt({displayMode:"family"})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"العرض العائلي (إخفاء أقسام)"})]})]})]}),i.displayMode==="family"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"الأقسام التي سيتم إخفاؤها"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto pr-2 border border-slate-700 p-2 rounded-lg",children:E.map(r=>{var p;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-red-600",checked:((p=i.hiddenCategories)==null?void 0:p.includes(r.id))||!1,onChange:j=>{const R=j.target.checked,M=r.id;let N=[...i.hiddenCategories||[]];const C=Fe(M,E);let V;if(R)V=Array.from(new Set([...N,M,...C]));else{const xe=new Set([M,...C]);V=N.filter(Ze=>!xe.has(Ze))}pt({hiddenCategories:V})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"الفتح في نافذة خارجية"}),e.jsx("p",{className:"text-xs text-slate-400",children:"تخصيص بعض الأقسام ليتم فتح وعرض العناصر بها في نافذة خارجية مباشرة."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>Y("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Ke==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>Y("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Ke==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),Ke==="websites"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:E.filter(r=>r.type==="websites").map(r=>{var p;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600",checked:((p=i.openInExternalWindowCategories_Websites)==null?void 0:p.includes(r.id))||!1,onChange:j=>{const R=j.target.checked,M=r.id,N="openInExternalWindowCategories_Websites";let C=[...i[N]||[]];const V=Fe(M,E);let xe;if(R)xe=Array.from(new Set([...C,M,...V]));else{const Ze=new Set([M,...V]);xe=C.filter(bt=>!Ze.has(bt))}pt({[N]:xe})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),Ke==="elements"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:D.map(r=>{var p;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-purple-600",checked:((p=i.openInExternalWindowCategories_Elements)==null?void 0:p.includes(r.id))||!1,onChange:j=>{const R=j.target.checked,M=r.id,N="openInExternalWindowCategories_Elements";let C=[...i[N]||[]];const V=Fe(M,E);let xe;if(R)xe=Array.from(new Set([...C,M,...V]));else{const Ze=new Set([M,...V]);xe=C.filter(bt=>!Ze.has(bt))}pt({[N]:xe})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات التشغيل"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"وضع التشغيل"}),e.jsxs("select",{value:i.playbackMode,onChange:r=>c({...i,playbackMode:r.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white",children:[e.jsx("option",{value:"sequential",children:"متسلسل (بالترتيب)"}),e.jsx("option",{value:"random",children:"عشوائي"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"وضع البدء الافتراضي"}),e.jsxs("select",{value:i.startupMode,onChange:r=>c({...i,startupMode:r.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white",children:[e.jsx("option",{value:"playlist",children:"تشغيل قائمة التشغيل"}),e.jsx("option",{value:"repository",children:"تشغيل المستودع"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:i.autoPlay,onChange:r=>c({...i,autoPlay:r.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-blue-600 focus:ring-blue-600"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-blue-400 transition-colors",children:"تشغيل تلقائي (الانتقال للفيديو التالي)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:i.loop,onChange:r=>c({...i,loop:r.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-blue-600 focus:ring-blue-600"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-blue-400 transition-colors",children:"تكرار القائمة"})]})]})]})]})]}),Z==="quickList"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-green-400 flex items-center gap-2",children:[e.jsx(us,{})," محتويات القائمة السريعة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{$("quickList"),alert("تم تفعيل القائمة السريعة."),m()},className:`px-3 py-1 text-xs font-bold rounded transition-colors ${L==="quickList"?"bg-green-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"تفعيل هذه القائمة"}),e.jsx("button",{onClick:()=>{confirm("هل أنت متأكد؟")&&P([])},className:"bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-xs font-bold",children:"مسح الكل"})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات التشغيل السريع التلقائي"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"طريقة اختيار الأفلام"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"sequential",checked:i.quickPlaySelectionMethod==="sequential",onChange:r=>c(p=>({...p,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"بالترتيب (عنصران مختلفان من كل قسم مختار)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"random_one_category",checked:i.quickPlaySelectionMethod==="random_one_category",onChange:r=>c(p=>({...p,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عشوائي (عنصران مختلفان من قسم واحد عشوائي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"two_from_each",checked:i.quickPlaySelectionMethod==="two_from_each",onChange:r=>c(p=>({...p,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عنصران متتاليان مختلفان في كل مرة من كل قسم مختار"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"اختيار الأقسام المستهدفة"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>h("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Re==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>h("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Re==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),Re==="websites"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:E.filter(r=>r.type==="websites").map(r=>{var p;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-green-600",checked:((p=i.quickPlaySelectedCategories)==null?void 0:p.includes(r.id))||!1,onChange:j=>{const R=j.target.checked,M=r.id;let N=[...i.quickPlaySelectedCategories||[]];if(R){N.push(M);const C=Fe(M,E);N=Array.from(new Set([...N,...C]))}else{N=N.filter(V=>V!==M);const C=Fe(M,E);N=N.filter(V=>!C.has(V))}c(C=>({...C,quickPlaySelectedCategories:N}))}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),Re==="elements"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:E.filter(r=>r.type==="elements").map(r=>{var p;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-green-600",checked:((p=i.quickPlaySelectedCategories)==null?void 0:p.includes(r.id))||!1,onChange:j=>{const R=j.target.checked,M=r.id;let N=[...i.quickPlaySelectedCategories||[]];if(R){N.push(M);const C=Fe(M,E);N=Array.from(new Set([...N,...C]))}else{N=N.filter(V=>V!==M);const C=Fe(M,E);N=N.filter(V=>!C.has(V))}c(C=>({...C,quickPlaySelectedCategories:N}))}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>c(r=>({...r,quickPlaySelectedCategories:Re==="websites"?[...y.map(p=>p.id),...(i.quickPlaySelectedCategories||[]).filter(p=>D.some(j=>j.id===p))]:[...D.map(p=>p.id),...(i.quickPlaySelectedCategories||[]).filter(p=>y.some(j=>j.id===p))]})),className:"text-xs text-blue-400 hover:text-blue-300",children:"تحديد الكل"}),e.jsx("button",{onClick:()=>c(r=>({...r,quickPlaySelectedCategories:Re==="websites"?(i.quickPlaySelectedCategories||[]).filter(p=>!y.some(j=>j.id===p)):(i.quickPlaySelectedCategories||[]).filter(p=>!D.some(j=>j.id===p))})),className:"text-xs text-red-400 hover:text-red-300",children:"إلغاء الكل"})]})]})]})," ",g.length>0?e.jsx("div",{className:"space-y-2",children:g.map((r,p)=>{var j;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:p+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base text-slate-300 truncate",children:r.title}),r.categoryId&&E.find(R=>R.id===r.categoryId)&&e.jsxs("p",{className:"text-[10px] text-slate-500",children:["المجلد: ",(j=E.find(R=>R.id===r.categoryId))==null?void 0:j.name]})]})]}),e.jsx("button",{onClick:()=>P(R=>R.filter(M=>M.id!==r.id)),className:"p-1.5 text-slate-500 hover:text-red-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(be,{className:"w-4 h-4"})})]},r.id+"-"+p)})}):e.jsxs("div",{className:"text-center text-slate-500 py-10",children:[e.jsx("p",{className:"mb-4",children:"القائمة السريعة فارغة."}),e.jsx("button",{onClick:()=>{alert('استخدم زر "تشغيل الآن" بجانب أي فيديو في المستودع لإضافته.'),m()},className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-bold",children:"إضافة من المستودع"})]})]}),Z==="playlist"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-blue-400 flex items-center gap-2",children:[e.jsx(Lt,{})," قائمة التشغيل الحالية"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:fe,className:"bg-purple-600 hover:bg-purple-500 text-white px-3 py-1 rounded text-xs font-bold flex items-center gap-1",children:[e.jsx(_s,{className:"w-3 h-3"})," حفظ كقائمة جديدة"]}),e.jsx("button",{onClick:()=>{$("playlist"),alert("تم تفعيل قائمة التشغيل الحالية."),m()},className:`px-3 py-1 text-xs font-bold rounded transition-colors ${L==="playlist"?"bg-blue-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"تفعيل هذه القائمة"}),e.jsx("button",{onClick:Le,className:"bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-xs font-bold",children:"مسح الكل"})]})]}),x.length>0?e.jsx("div",{className:"space-y-2",children:x.map((r,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:p+1}),e.jsx("p",{className:"font-medium text-base text-slate-300 truncate",children:r.title})]}),e.jsx("button",{onClick:()=>f(j=>j.filter(R=>R.playlistId!==r.playlistId)),className:"p-1.5 text-slate-500 hover:text-red-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(be,{className:"w-4 h-4"})})]},r.playlistId))}):e.jsx("div",{className:"text-center text-slate-500 py-10",children:"قائمة التشغيل فارغة. أضف فيديوهات من المستودع."})]}),Z==="savedPlaylists"&&e.jsxs("div",{className:"space-y-2",children:[re.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-800/70 rounded-lg border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded flex items-center justify-center",children:e.jsx(Lt,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-200",children:r.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.items.length," فيديو"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>Ge(r.id),className:"p-2 hover:bg-red-900/30 text-slate-400 hover:text-red-400 rounded-lg transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})})]},r.id)),re.length===0&&e.jsx("div",{className:"text-center text-slate-500 py-10",children:"لا توجد قوائم تشغيل محفوظة."})]}),Z==="categories"&&e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-4 mb-6 p-4 border border-slate-700 rounded-lg bg-slate-800/50",children:[e.jsx("h4",{className:"font-bold text-slate-300 border-b border-slate-700 pb-2 mb-3",children:"إضافة قسم جديد"}),e.jsx("input",{type:"text",placeholder:"اسم القسم الجديد",value:Me,onChange:r=>Xe(r.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white placeholder-slate-500"}),e.jsxs("div",{className:"flex gap-4 mt-3",children:[e.jsxs("label",{className:"inline-flex items-center text-sm text-slate-300",children:[e.jsx("input",{type:"radio",name:"newCategoryType",value:"websites",checked:de==="websites",onChange:()=>Nt("websites"),className:"form-radio text-blue-500"}),e.jsx("span",{className:"ml-2",children:"مواقع"})]}),e.jsxs("label",{className:"inline-flex items-center text-sm text-slate-300",children:[e.jsx("input",{type:"radio",name:"newCategoryType",value:"elements",checked:de==="elements",onChange:()=>Nt("elements"),className:"form-radio text-purple-500"}),e.jsx("span",{className:"ml-2",children:"عناصر"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{Me.trim()?($e(Me,de),Xe("")):alert("الرجاء إدخال اسم للقسم.")},className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-3 rounded-lg text-xs",children:"إضافة قسم رئيسي"}),e.jsxs("select",{value:vt,onChange:r=>at(r.target.value),className:"bg-slate-700 border border-slate-600 rounded-lg p-2 text-xs text-white",children:[e.jsx("option",{value:"",children:"اختر القسم الأب"}),E.filter(r=>r.type===de).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("button",{onClick:()=>{Me.trim()&&vt?($e(Me,de,vt),Xe(""),at("")):Me.trim()?alert("الرجاء اختيار قسم أب."):alert("الرجاء إدخال اسم للقسم الفرعي.")},className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-3 rounded-lg text-xs",disabled:E.filter(r=>r.type===de).length===0,children:"إضافة قسم فرعي"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6 p-4 border border-red-700 rounded-lg bg-red-900/20",children:[e.jsx("h4",{className:"font-bold text-red-400 border-b border-red-700 pb-2 mb-3",children:"⭐ إعدادات مجلد المفضلة"}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"اختر مجلد المفضلة الافتراضي لكل قسم. عند الضغط على زر النجمة، سيتم إضافة العنصر إلى هذا المجلد."}),e.jsx("div",{className:"space-y-3",children:E.filter(r=>!r.parentId).map(r=>{var p;return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-800/50 rounded-lg",children:[e.jsxs("label",{className:"text-sm text-slate-300 min-w-[100px] font-medium",children:[r.name,":"]}),e.jsxs("select",{value:((p=i.categoriesFavoriteFolders)==null?void 0:p[r.id])||"",onChange:j=>{c(R=>({...R,categoriesFavoriteFolders:{...R.categoriesFavoriteFolders,[r.id]:j.target.value}}))},className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg p-1.5 text-xs text-white",children:[e.jsx("option",{value:"",children:"-- لم يتم التحديد --"}),E.filter(j=>j.type===r.type).map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]},r.id)})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>xt("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${He==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>xt("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${He==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),e.jsxs("div",{className:"space-y-2",children:[z.map(r=>e.jsx(Ce,{category:r,allCategories:E,level:0,editingCategory:$t,editName:lt,handleEditCategory:Kt,renameCategory:ve,deleteCategoryRecursive:dt,handleDragStart:_t,handleDragOver:Xt,handleDrop:Ht,handleDragEnd:Qe,draggedCategory:B,handleSetExpandedCategories:()=>Pt(r.id),orderNumberChangeHandler:bs},r.id)),z.length===0&&e.jsx("div",{className:"text-center text-slate-500 py-4",children:"لا توجد أقسام من هذا النوع."})]})]}),Z==="maintenance"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"p-6 bg-yellow-900/10 border border-yellow-500/20 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-yellow-400 mb-2 flex items-center gap-2",children:[e.jsx(Os,{className:"w-4 h-4"})," تنظيف المكررات"]}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"البحث عن الفيديوهات التي لها نفس الرابط وحذف النسخ المكررة من المستودع."}),e.jsx("button",{onClick:Ys,className:"bg-yellow-600 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg text-xs font-bold",children:"بدء الفحص"})]})})]})]}),wt&&e.jsx(Nr,{isOpen:wt,onClose:()=>_e(!1),repository:U,setRepository:W,categories:E,settings:i,setSettings:c,handleDeleteItems:We,handleMoveItems:te,handlePreviewItem:se,handleEditVideo:ke,setEditingVideo:H,setShowEditModal:Ee,initialSelectedItems:jt,setInitialSelectedItems:ge})]})},kr=({vid:n,itemIndex:m,currentVideoId:i,categories:c,onVideoClick:x,onPreview:f,onPlayNow:g,onAddToPlaylist:P,onEdit:L,onDelete:$,onMoveToTop:O,onAddToFavorites:U,viewMode:W,isSelected:E,setItemRef:re})=>{const[fe,Ge]=o.useState(!1);return W==="grid"?e.jsxs("div",{ref:re,className:`group relative aspect-video max-h-42 bg-slate-800 rounded-lg overflow-hidden cursor-pointer shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-yellow-500/30 ${E?"ring-4 ring-yellow-500 bg-yellow-900/30":"hover:ring-2 hover:ring-yellow-500/50"}`,onClick:A=>x(A,n),children:[E&&e.jsx("div",{className:"absolute top-2 left-2 z-20",children:e.jsx("div",{className:"bg-yellow-500 rounded-full p-1 shadow-lg",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),n.movies_img&&!fe?e.jsx("img",{src:n.movies_img,alt:n.title,className:"w-full h-full object-cover video-item-image-or-fallback",style:{opacity:"1",visibility:"visible",display:"block"},onError:()=>Ge(!0)}):e.jsx("div",{className:"w-full h-full bg-slate-900 flex items-center justify-center text-center p-4 text-xl font-bold text-yellow-500 bg-gradient-to-br from-slate-900 to-slate-800 video-item-image-or-fallback",title:n.title,style:{opacity:"1",visibility:"visible",display:"block"},children:e.jsxs("span",{className:"line-clamp-3",children:[typeof m=="number"&&e.jsxs("span",{className:"text-yellow-400 font-mono text-lg",children:[m+1,". "]}),n.title||"بلا عنوان"]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-black/40"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 z-10 bg-black/30 backdrop-blur-sm",children:e.jsxs("h3",{className:"text-sm font-bold text-white line-clamp-2 video-item-title-h3",style:{opacity:"1",visibility:"visible",display:"block"},children:[typeof m=="number"&&e.jsxs("span",{className:"text-yellow-400 font-mono",children:[m+1,". "]}),n.title||"بلا عنوان"]})}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{onClick:A=>{A.stopPropagation(),g(n)},className:"bg-yellow-600 text-white rounded-full p-4 shadow-lg hover:scale-110 transition-transform",children:e.jsx(tt,{className:"w-6 h-6 fill-current"})})}),e.jsxs("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-20 flex gap-2",children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),U(n)},className:"bg-red-600 text-white rounded-full p-2 shadow-lg hover:scale-110 transition-transform",title:"إضافة إلى المفضلة",children:e.jsx(Nl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),P(n)},className:"bg-yellow-600 text-white rounded-full p-2 shadow-lg hover:scale-110 transition-transform",title:"إضافة إلى قائمة التشغيل",children:e.jsx(it,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{onClick:A=>{A.stopPropagation(),confirm("حذف الفيديو؟")&&$(n.id)},className:"p-1.5 bg-red-800/70 hover:bg-red-700 rounded-full text-white transition-colors",title:"حذف",children:e.jsx(be,{className:"w-4 h-4"})})})]}):e.jsxs("div",{ref:re,className:`group flex flex-col py-2 px-2 rounded-lg transition-all cursor-pointer w-full ${E?"bg-yellow-800/70 ring-2 ring-yellow-500":i===n.id?"ring-2 ring-yellow-500/80 shadow-lg shadow-yellow-500/30 bg-slate-800":"hover:bg-yellow-800/60"}`,onClick:A=>x(A,n),children:[e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[E?e.jsx("div",{className:"bg-yellow-500 rounded-full p-1 shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}):e.jsx(tt,{className:"w-4 h-4 text-slate-500 group-hover:text-yellow-400 transition-colors flex-shrink-0"}),e.jsxs("span",{className:"text-base font-semibold text-slate-300 group-hover:text-white transition-colors flex-1",children:[typeof m=="number"&&e.jsxs("span",{className:"text-yellow-400 w-6 inline-block",children:[m+1,"."]}),n.title]})]}),e.jsx("div",{className:"relative self-end mt-1",children:e.jsxs("div",{className:"absolute right-0 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),g(n)},className:"p-1.5 bg-yellow-600/20 hover:bg-yellow-600/40 rounded-md text-yellow-300 hover:text-white transition-colors",title:"تشغيل الآن",children:e.jsx(tt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),U(n)},className:"p-1.5 bg-red-600/20 hover:bg-red-600/40 rounded-md text-red-300 hover:text-white transition-colors",title:"إضافة إلى المفضلة",children:e.jsx(Nl,{className:"w-3 h-3"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),P(n)},className:"p-1.5 bg-slate-700/50 hover:bg-slate-700 rounded-md text-slate-300 hover:text-white transition-colors",title:"إضافة للقائمة",children:e.jsx(it,{className:"w-3 h-3"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),O(n.id)},className:"p-1.5 bg-green-600/20 hover:bg-green-600/40 rounded-md text-green-300 hover:text-white transition-colors",title:"نقل إلى الأعلى",children:e.jsx(Ya,{className:"w-3 h-3"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),L(n)},className:"p-1.5 bg-slate-700/50 hover:bg-slate-700 rounded-md text-slate-300 hover:text-white transition-colors",title:"تعديل",children:e.jsx(Yl,{className:"w-3 h-3"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),confirm("حذف الفيديو؟")&&$(n.id)},className:"p-1.5 bg-red-800/50 hover:bg-red-700 rounded-md text-red-400 hover:text-white transition-colors",title:"حذف",children:e.jsx(be,{className:"w-3 h-3"})})]})})]})},Fl=Te.memo(kr),Cr=({item:n,index:m,currentIndex:i,onPlay:c,onRemove:x,onMove:f})=>e.jsxs("div",{className:`group flex items-center justify-between p-2 rounded-lg transition-all cursor-pointer ${i===m?"bg-blue-600/20":"hover:bg-slate-800"}`,onClick:()=>c(m),children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs font-mono text-slate-500",children:m+1}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"text-base font-medium text-slate-300 truncate",children:n.title})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),f(m,m-1)},className:"p-1 hover:bg-slate-700 rounded disabled:opacity-50",disabled:m===0,title:"Move Up",children:e.jsx(Bl,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),f(m,m+1)},className:"p-1 hover:bg-slate-700 rounded disabled:opacity-50",title:"Move Down",children:e.jsx(Ul,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),x(n.playlistId)},className:"p-1 text-red-500/80 hover:bg-red-900/50 hover:text-red-400 rounded",title:"Remove",children:e.jsx(be,{className:"w-3.5 h-3.5"})})]})]}),Sr=Te.memo(Cr),Ir=()=>{const n=o.useRef(null),[m,i]=o.useState(null),[c,x]=o.useState([{id:"default",name:"عام",type:"websites"}]),[f,g]=o.useState([]),[P,L]=o.useState([]),[$,O]=o.useState(-1),[U,W]=o.useState(!1),[E,re]=o.useState(!1),[fe,Ge]=o.useState("single"),[A,ne]=o.useState(!1),[hs,Le]=o.useState("json"),[$e,ve]=o.useState("websites"),[dt,Ve]=o.useState(!1),[me,ut]=o.useState(1),[ce,We]=o.useState("playlist"),[te,se]=o.useState("playlist"),[ke,H]=o.useState(null),[Ee,wt]=o.useState("default"),[_e,jt]=o.useState("default"),[ge,Z]=o.useState(["default"]),[oe,$t]=o.useState(!1),[Ae,lt]=o.useState(!1),[Je,Me]=o.useState(!1),[Xe,de]=o.useState(!1),[Nt,vt]=o.useState(!1),[at,He]=o.useState(!1),[xt,Ke]=o.useState(!1),[Y,Re]=o.useState(!1),[h,y]=o.useState(null),[D,z]=o.useState(null),[B,K]=o.useState(null),[k,_]=o.useState(null),[G,le]=o.useState(!0),[ue,ae]=o.useState({x:0,y:0}),[mt,ht]=o.useState(!1),[kt,At]=o.useState(null),[Ct,St]=o.useState(1),[ps,Jt]=o.useState(1),[Ce,qe]=o.useState("list"),[ye,Rt]=o.useState(null),[Ot,rt]=o.useState("websites"),[we,It]=o.useState(null),[Dt,Pt]=o.useState(!1),[bs,_t]=o.useState(!1),[Xt,Ht]=o.useState(""),[Qe,Kt]=o.useState(""),[pt,Ys]=o.useState(!1),[Qt,r]=o.useState(!1),[p,j]=o.useState(!1),[R,M]=o.useState([]),[N,C]=o.useState(!1),[V,xe]=o.useState(!1),[Ze,bt]=o.useState([]),[he,Ye]=o.useState([]),[Bs,fs]=o.useState(""),[Zt,qt]=o.useState({}),[q,Be]=o.useState({playbackMode:"sequential",startupMode:"playlist",duration:15,autoPlay:!0,loop:!0,autoDetect:!1,selectedCategories:["default"],autoPlayWebVideos:!0,autoZoomWebVideos:!0,openInNewWindowOnFullscreenFail:!0,showControlPanel:!1,startMuted:!1,quickPlaySelectedCategories:["default"],quickPlaySelectionMethod:"sequential",quickPlayOffsets:{},itemsSortOrder:"newest",openInExternalWindowCategories_Websites:[],openInExternalWindowCategories_Elements:[],displayMode:"full",hiddenCategories:[]}),[Ft,ft]=o.useState(!1),[gs,Et]=o.useState(!1),[Mt,ot]=o.useState(!0),[J,pe]=o.useState({phase:"quick",loaded:0,total:0}),[Oe,ys]=o.useState([]),[es,Us]=o.useState(null),[zs,ws]=o.useState([]),[js,Gs]=o.useState(!1),[Kl,Vt]=o.useState(!1),[Tt,Ns]=o.useState(""),[Yt,Ws]=o.useState("local"),[vs,Js]=o.useState([]),[ts,ks]=o.useState(null),Ql=t=>{if(!t)return t;try{const s=new URL(t);return["google.com","wikipedia.org","facebook.com","twitter.com"].some(a=>s.hostname.includes(a))?t:(s.searchParams.has("autoplay")||s.searchParams.set("autoplay","1"),s.searchParams.has("mute")||s.searchParams.set("mute","1"),(s.hostname.includes("youtube.com")||s.hostname.includes("youtu.be"))&&(s.searchParams.has("playsinline")||s.searchParams.set("playsinline","1")),s.toString())}catch{return t}},Xs=t=>{const a=(window.screen.width-1280)/2,u=(window.screen.height-720)/2,d=`width=1280,height=720,menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes,left=${a},top=${u}`;let b=t;(b.includes("youtube.com")||b.includes("youtu.be"))&&(b.includes("autoplay=1")||(b+=b.includes("?")?"&autoplay=1":"?autoplay=1"),b.includes("mute=1")||(b+="&mute=1"));try{window.open(b,"_blank",d)}catch(T){console.error("Failed to open external window",T)}};o.useRef(null);const je=o.useRef(null),nt=o.useRef(null),ss=o.useRef({}),Hs=o.useCallback(async()=>{try{await Fs(f),await Wl(P),await Jl(c),await Vs(q)}catch(t){console.error("Auto-save to IndexedDB failed:",t)}},[c,f,P,q]);o.useCallback(async()=>{const s=yr({categories:c,repository:f,playlist:P,settings:q});try{if(es){const l=await es.createWritable();await l.write(JSON.stringify(s,null,2)),await l.close(),alert(`تم حفظ البيانات بنجاح إلى الملف: ${es.name}
إجمالي العناصر: ${s.metadata.totalItems}
تحميل سريع: ${s.metadata.quickLoadItems}
تحميل كامل: ${s.metadata.fullLoadItems}`)}else if(window.showSaveFilePicker){const l=await window.showSaveFilePicker({suggestedName:"video-station-data.json",types:[{description:"JSON File",accept:{"application/json":[".json"]}}]}),a=await l.createWritable();await a.write(JSON.stringify(s,null,2)),await a.close(),Us(l),alert(`تم حفظ الملف بنجاح
إجمالي العناصر: ${s.metadata.totalItems}
تحميل سريع: ${s.metadata.quickLoadItems}
تحميل كامل: ${s.metadata.fullLoadItems}`)}else{const l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(l),u=document.createElement("a");u.href=a,u.download="video-station-data.json",u.click(),URL.revokeObjectURL(a),alert(`تم حفظ الملف بنجاح كملف تنزيل
إجمالي العناصر: ${s.metadata.totalItems}
تحميل سريع: ${s.metadata.quickLoadItems}
تحميل كامل: ${s.metadata.fullLoadItems}`)}}catch(l){console.error("Manual save failed:",l),alert("فشل الحفظ اليدوي للبيانات.")}},[c,f,P,q,es]),o.useEffect(()=>{(async()=>{ot(!0),pe({phase:"quick",loaded:0,total:1});try{console.log("Initializing application...");const s=await mr(),l=a=>{g(a.repository),x(a.categories.map((w,S)=>({...w,order:w.order??S})).sort((w,S)=>(w.order??0)-(S.order??0))),L(a.playlist),Be(w=>({...w,...a.settings})),M(a.savedPlaylists);const u=a.settings||q,d=a.repository||f,b=a.playlist||P,T=a.categories||c,I=u.startupMode||"playlist";if(We(I),se(I),I==="playlist"&&b.length>0)se("playlist"),O(0),W(!0);else if(I==="repository"&&d.length>0){const w=Array.isArray(u.quickPlaySelectedCategories)?u.quickPlaySelectedCategories:T.map(F=>F.id),S=d.filter(F=>w.includes(F.categoryId||"default"));if(S.length>0){let F=[];const Ne=u.quickPlaySelectionMethod||"sequential",ee={...u.quickPlayOffsets||{}};switch(Ne){case"sequential":let Q=ee.global_sequential||0;for(let ie=0;ie<10;ie++)F.push(S[(Q+ie)%S.length]);ee.global_sequential=(Q+10)%S.length;break;case"random_one_category":if(w.length>0){const ie=w[Math.floor(Math.random()*w.length)];F=[...d.filter(Se=>Se.categoryId===ie)].sort(()=>.5-Math.random()).slice(0,10)}else F=[...S].sort(()=>.5-Math.random()).slice(0,10);break;case"two_from_each":w.forEach(ie=>{const Se=[...d.filter(gt=>gt.categoryId===ie)].sort(()=>.5-Math.random()).slice(0,2);F.push(...Se)}),F=F.slice(0,10);break}F.length>0&&(ys(F),se("quickList"),O(0),W(!0),Be(Q=>({...Q,quickPlayOffsets:ee})))}}console.log("UI state and playback initialized.")};if(s&&s.repository.length>0)console.log("Loaded data from IndexedDB."),l(s),pe({phase:"complete",loaded:s.repository.length,total:s.repository.length}),ot(!1);else{console.log("Database is empty. Starting progressive load from local file."),pe({phase:"quick",loaded:0,total:1});const a=await fr();a?(console.log(`Quick load successful. Loaded ${a.repository.length} initial items.`),l(a),await hr(a),pe({phase:"quick",loaded:1,total:1}),console.log("Starting full data load in background..."),await gr({onProgress:u=>{pe({phase:"full",loaded:u.loaded,total:u.total})},onChunkLoaded:async u=>{console.log(`Loaded chunk of ${u.repository.length} items. Merging...`),await pr(u.repository),g(d=>_l(d,u.repository).repository),x(d=>_l({repository:[],categories:d},{repository:[],categories:u.categories}).categories)},onComplete:u=>{console.log(`Background load complete. Total items: ${u.repository.length}`),g(u.repository),x(u.categories),pe({phase:"complete",loaded:u.repository.length,total:u.repository.length}),ot(!1)}})):(ot(!1),pe({phase:"complete",loaded:0,total:0}))}}catch(s){console.error("Initialization failed:",s),ot(!1)}})()},[]),o.useEffect(()=>{const t=setTimeout(()=>{Mt||Hs()},3e3);return()=>clearTimeout(t)},[c,f,P,q,Hs,Mt]),o.useEffect(()=>{const t=()=>$t(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]),o.useEffect(()=>{E&&Ge("single")},[E]);const Bt=o.useRef(null),Cs=o.useCallback(t=>{oe&&t.clientY<100&&(Me(!0),Bt.current&&clearTimeout(Bt.current),Bt.current=setTimeout(()=>{Me(!1)},3e3))},[oe]);o.useEffect(()=>{if(oe)return document.addEventListener("mousemove",Cs),()=>{document.removeEventListener("mousemove",Cs),Bt.current&&clearTimeout(Bt.current)}},[oe,Cs,Me]),o.useLayoutEffect(()=>{m!==null&&n.current&&(n.current.scrollTop=m,i(null))},[m]);const Zl=t=>{if(!Y)return;t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),l=(t.clientX-s.left)/s.width*100,a=(t.clientY-s.top)/s.height*100;y({x:l,y:a}),z({x:l,y:a})},ea=t=>{if(!Y||!h)return;t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),l=(t.clientX-s.left)/s.width*100,a=(t.clientY-s.top)/s.height*100;z({x:l,y:a})},Ks=t=>{if(!Y||!h||!D)return;t.preventDefault();const s=Math.abs(D.x-h.x),l=Math.abs(D.y-h.y);if(s>3&&l>3){const a=Math.min(h.x,D.x),u=Math.min(h.y,D.y);_({x:a,y:u,width:s,height:l})}y(null),z(null)},ta=()=>{var t;if(k){if(K(k),(t=je.current)!=null&&t.parentElement){const s=je.current.parentElement.getBoundingClientRect(),l=s.width/(k.width/100*s.width),a=s.height/(k.height/100*s.height),u=Math.min(l,a);ut(u);const d=k.x+k.width/2,b=k.y+k.height/2,T=d/100*s.width*u,I=b/100*s.height*u,w=s.width/2,S=s.height/2,F=w-T,Ne=S-I;ae({x:F,y:Ne})}_(null),Re(!1),le(!0)}},sa=()=>{_(null),y(null),z(null)},la=t=>{me===1&&!B||Y||(t.preventDefault(),ht(!0),At({x:t.clientX-ue.x,y:t.clientY-ue.y}))},aa=t=>{if(!mt||!kt)return;t.preventDefault();const s=t.clientX-kt.x,l=t.clientY-kt.y;ae({x:s,y:l})},Qs=()=>{ht(!1),At(null)},ra=()=>{K(null),_(null),ut(1),ae({x:0,y:0}),Re(!1),y(null),z(null),ht(!1),At(null),St(1),Jt(1),le(!0)},ls=t=>{ae(l=>{switch(t){case"up":return{x:l.x,y:l.y+50};case"down":return{x:l.x,y:l.y-50};case"left":return{x:l.x+50,y:l.y};case"right":return{x:l.x-50,y:l.y};default:return l}})},De=Te.useMemo(()=>{switch(te){case"quickList":return Oe;case"playlist":return P;case"repository":return f.filter(t=>q.selectedCategories.includes(t.categoryId||"default"));default:return P}},[te,Oe,P,f,q.selectedCategories]),v=ke||De[$];o.useEffect(()=>{if(Ae&&v&&ss.current[v.id]){const t=c.find(s=>s.id===v.categoryId);if(t){const s=ge.includes(t.id),l=t.parentId&&ge.includes(t.parentId);(s||l)&&setTimeout(()=>{var a;(a=ss.current[v.id])==null||a.scrollIntoView({behavior:"smooth",block:"center"})},150)}}},[v,ge,c,Ae]);const Ue=o.useCallback(()=>{if(ke||De.length===0)return;let t=0;if(q.playbackMode==="random")t=Math.floor(Math.random()*De.length);else if(t=($+1)%De.length,t===0&&!q.loop){W(!1);return}O(t)},[De,$,q,ke]),Zs=o.useCallback(()=>{if(ke||De.length===0)return;const t=($-1+De.length)%De.length;O(t)},[De,$,ke]);o.useEffect(()=>{if(!je.current||!v||!v.url||!U||fl(v.url)||v.url.match(/\.(mp4|webm|ogg)$/i))return;let t=!1;const s=je.current;let l=null,a=null;const u=()=>{console.error("Iframe failed to load (network error). Skipping to next video."),Ue()},d=I=>{a&&clearInterval(a),a=setInterval(()=>{try{(I.ended||I.duration>0&&I.currentTime>=I.duration-1)&&(q.autoPlay&&(console.log("Video ended, advancing to next."),Ue()),a&&clearInterval(a))}catch{a&&clearInterval(a)}},1e3)},b=()=>{var S;t=!0;let I=!1,w=!1;try{I=!!((S=s.contentWindow)!=null&&S.document.location.href);const F=s.contentDocument;if(F){const Ne=[".error",".error-message",".error-page",'[class*="error"]','[id*="error"]',".refused",".connection-refused",'[class*="refused"]','[id*="refused"]'];for(const ee of Ne){const Q=F.querySelector(ee);if(Q&&Q.textContent){const ie=Q.textContent.toLowerCase();if(ie.includes("refused to connect")||ie.includes("connection refused")||ie.includes("access denied")||ie.includes("forbidden")){w=!0,console.error(`Error detected in iframe: ${ie}`);break}}}}}catch{I=!1}if(I&&!w){console.log("Iframe finished loading and is accessible. Starting auto-play enforcer."),l&&clearInterval(l),a&&clearInterval(a);let F=0;const Ne=30;l=setInterval(()=>{if(F>=Ne){l&&clearInterval(l);return}F++;try{const ee=s.contentDocument;if(!ee){l&&clearInterval(l);return}const Q=ee.querySelector("video");if(Q&&!Q.paused){l&&clearInterval(l),d(Q);return}const ie=['button[aria-label*="Play"]','button[aria-label*="play"]',".ytp-play-button",".play-button",'[data-testid="play-button"]',".vjs-big-play-button",'div[role="button"][aria-label*="Play"]'],et=ee.querySelector(ie.join(", "));if(et instanceof HTMLElement&&et.offsetParent!==null){et.click();return}if(Q&&Q.paused){Q.muted=!0,Q.play().catch(()=>{});return}}catch{l&&clearInterval(l)}},500)}else console.error("Iframe content is not accessible (likely due to X-Frame-Options)."),console.log("Iframe is not accessible, but we will keep it in the app.")},T=setTimeout(()=>{t||(console.error("Iframe failed to load within timeout period."),console.log("Iframe failed to load, but we will keep it in the app."))},5e3);return s.addEventListener("load",b),s.addEventListener("error",u),()=>{clearTimeout(T),s.removeEventListener("load",b),s.removeEventListener("error",u),l&&clearInterval(l),a&&clearInterval(a)}},[v,q.autoPlay,Ue]),o.useEffect(()=>{if(!v||!Ms(v.url)){if(nt.current&&nt.current.destroy){try{document.getElementById("youtube-player-container")&&nt.current.destroy()}catch(l){console.error("Error destroying YouTube player:",l)}nt.current=null}return}const t=Ms(v.url);if(!t)return;const s=()=>{if(nt.current&&nt.current.destroy)try{nt.current.destroy()}catch(l){console.error("Error destroying YouTube player:",l)}if(document.getElementById("youtube-player-container"))try{nt.current=new window.YT.Player("youtube-player-container",{videoId:t,playerVars:{autoplay:1,enablejsapi:1,origin:window.location.origin,host:"https://www.youtube.com",widget_referrer:window.location.href,mute:q.startMuted?1:0},events:{onReady:l=>{q.autoPlay&&l.target.playVideo()},onStateChange:l=>{l.data===0&&q.autoPlay&&Ue()},onError:l=>{const a=l.data;console.error("YouTube Player error:",a),(a===101||a===150||a===100)&&v&&v.url&&console.log(`YouTube error ${a}, but we will keep it in the app.`),Ue()}}})}catch(l){console.error("YouTube Player API initialization error:",l)}};if(!window.YT||!window.YT.Player){const l=document.createElement("script");l.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];a&&a.parentNode&&a.parentNode.insertBefore(l,a),window.onYouTubeIframeAPIReady=s}else s()},[v,q.autoPlay,Ue,q.startMuted]),o.useEffect(()=>{v&&ws(t=>{const s=t.findIndex(a=>a.id===v.id);let l=[...t];return s!==-1&&l.splice(s,1),l.unshift(v),l})},[v]);const el=t=>{var a;if(!((a=je.current)!=null&&a.parentElement))return;const s=je.current.parentElement.getBoundingClientRect(),l={x:s.width/2,y:s.height/2};ut(u=>{const d=t==="in"?Math.min(u+.1,5):Math.max(u-.1,.5);return d===u?u:(ae(b=>{const T=l.x-(l.x-b.x)*(d/u),I=l.y-(l.y-b.y)*(d/u);return{x:T,y:I}}),d)})},tl=()=>{el("in")},sl=()=>{el("out")},ll=()=>{ra()},oa=()=>{ut(1.35),ae({x:0,y:0}),K({x:0,y:0,width:100,height:100}),le(!0)},al=o.useCallback(t=>{H(t)},[]),rl=(t,s)=>{const{ctrlKey:l,metaKey:a,shiftKey:u}=t,d=c.find(b=>b.id===s.categoryId);if(d&&!l&&!a&&!u){const b=[d.id];let T=d;for(;T.parentId;)b.push(T.parentId),T=c.find(S=>S.id===T.parentId)||T;const I=d.type==="websites"&&b.some(S=>{var F;return(F=q.openInExternalWindowCategories_Websites)==null?void 0:F.includes(S)}),w=d.type==="elements"&&b.some(S=>{var F;return(F=q.openInExternalWindowCategories_Elements)==null?void 0:F.includes(S)});if(I||w){Xs(s.url);return}}if(l||a)t.preventDefault(),Ye(b=>b.includes(s.id)?b.filter(T=>T!==s.id):[...b,s.id]);else if(u&&he.length>0){t.preventDefault();const b=f.filter(S=>S.categoryId===s.categoryId),T=he[he.length-1],I=b.findIndex(S=>S.id===T),w=b.findIndex(S=>S.id===s.id);if(I!==-1&&w!==-1){const S=Math.min(I,w),F=Math.max(I,w),Ne=b.slice(S,F+1).map(ee=>ee.id);Ye(ee=>[...new Set([...ee,...Ne])])}}else Ye([s.id]),rs(s)},Ss=o.useCallback(t=>{It(t),Pt(!0)},[]),na=t=>{if(t.preventDefault(),!we)return;const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("url"),u=s.get("categoryId");g(d=>d.map(b=>b.id===we.id?{...b,title:l,url:a,categoryId:u||b.categoryId||"default"}:b)),Pt(!1),It(null)},ia=t=>{t.preventDefault();const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("categoryId"),u=Xt||Qe;if(l&&u){const d={id:Math.random().toString(36).substr(2,9),title:l,url:u,timestamp:Date.now(),categoryId:a||"default"};g([...f,d]),_t(!1),alert("تم حفظ الرابط بنجاح!")}},ca=t=>{if(t==="default"){alert("لا يمكن حذف محتويات القسم العام بهذه الطريقة.");return}const s=c.find(l=>l.id===t);s&&confirm(`هل أنت متأكد من حذف جميع العناصر داخل قسم "${s.name}"؟ سيتم حذف الفيديوهات نهائياً ولن يتم نقلها.`)&&(g(l=>l.filter(a=>a.categoryId!==t)),alert(`تم حذف جميع العناصر من قسم "${s.name}".`))},ol=t=>{Z(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},da=o.useCallback((t,s,l)=>{if(!t||!t.trim())return;const a={id:Math.random().toString(36).substr(2,9),name:t.trim(),type:s,parentId:l};x(u=>[...u,a])},[]),ua=o.useCallback(t=>{const s=Fe(t,c),l=new Set([t,...Array.from(s)]);return f.filter(a=>l.has(a.categoryId||"")).length},[f,c]),xa=o.useCallback((t,s)=>{if(!s.trim()){alert("لا يمكن أن يكون اسم القسم فارغًا.");return}x(l=>l.map(u=>u.id===t?{...u,name:s.trim()}:u))},[]),nl=o.useCallback(t=>{if(t==="default"){alert("لا يمكن حذف القسم العام.");return}x(s=>{const l=s.find(d=>d.id===t);if(!l||!confirm(`هل أنت متأكد من حذف قسم "${l.name}"؟ سيتضمن الحذف جميع الأقسام الفرعية والعناصر المرتبطة به. هذه العملية لا يمكن التراجع عنها.`))return s;const a=Fe(t,s),u=s.filter(d=>!a.has(d.id));return g(d=>d.map(b=>{if(a.has(b.categoryId||"")){let T=l.parentId;for(;T&&a.has(T);){const I=s.find(w=>w.id===T);T=I==null?void 0:I.parentId}return{...b,categoryId:T||"default"}}return b})),Z(d=>d.filter(b=>!a.has(b))),u})},[Fe]),ma=o.useCallback(t=>{x(s=>{const l=new Map(t.map(u=>[u.id,{...u}]));return s.map(u=>l.has(u.id)?l.get(u.id):u).sort((u,d)=>(u.order??0)-(d.order??0))})},[]);o.useCallback((t,s)=>{g(l=>l.map(a=>a.id===t?{...a,categoryId:s}:a))},[]);const ha=t=>{const s=f.filter(a=>a.categoryId===t);if(s.length===0){alert("المجلد فارغ");return}const l=s.map(a=>({...a,playlistId:`playlist_${Date.now()}_${Math.random()}`,videoId:a.id}));L(a=>[...a,...l]),alert(`تم إضافة ${s.length} فيديو إلى قائمة التشغيل`)},il=t=>{if(f.filter(l=>l.categoryId===t).length===0){alert("المجلد فارغ");return}se("repository"),Be(l=>({...l,selectedCategories:[t]})),O(0),W(!0)},pa=async(t,s)=>{if(!t.trim()){alert("الرجاء إدخال روابط");return}const l=t.split(`
`).filter(a=>a.trim()!=="");if(l.length>0){const a=l.map(async d=>{const{title:b,movies_img:T}=await pl(d.trim());return{id:Math.random().toString(36).substr(2,9),title:b,url:d.trim(),movies_img:T,timestamp:Date.now(),categoryId:s}}),u=await Promise.all(a);g(d=>[...d,...u]),alert(`تمت إضافة ${u.length} رابط إلى القسم المحدد بنجاح`),re(!1)}else alert("لم يتم العثور على روابط صالحة.")},ba=async t=>{t.preventDefault();const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("url"),u=s.get("categoryId");if(a){const{title:d,movies_img:b}=await pl(a.trim()),T=l.trim()!==""?l:d,I={id:Math.random().toString(36).substr(2,9),title:T,url:a,movies_img:b,timestamp:Date.now(),categoryId:u||"default"};g([...f,I]),re(!1)}else alert("الرجاء إدخال رابط للفيديو.")},as=o.useCallback(t=>{const s={...t,playlistId:Math.random().toString(36).substr(2,9)};L(l=>[...l,s]),$===-1&&O(0)},[$]),cl=o.useCallback(t=>{confirm("حذف الفيديو؟")&&g(s=>s.filter(l=>l.id!==t))},[]),dl=o.useCallback(t=>{confirm(`هل أنت متأكد من حذف ${t.length} عنصر؟`)&&g(s=>s.filter(l=>!t.includes(l.id)))},[]),fa=o.useCallback((t,s)=>{g(l=>l.map(a=>t.includes(a.id)?{...a,categoryId:s}:a))},[]),ul=o.useCallback(t=>{n.current&&i(n.current.scrollTop),Be(s=>({...s,itemsSortOrder:"manual"})),g(s=>{const l=s.findIndex(I=>I.id===t);if(l===-1)return i(null),s;const a={...s[l],timestamp:Date.now()},u=a.categoryId,d=s.findIndex(I=>I.categoryId===u);if(l===d)return i(null),s.map(I=>I.id===t?a:I);const b=[...s];b.splice(l,1);const T=b.findIndex(I=>I.categoryId===u);return T!==-1?b.splice(T,0,a):b.unshift(a),b})},[]),xl=o.useCallback(t=>{var T,I;let s=c.find(w=>w.id===t.categoryId),l=s==null?void 0:s.id;if(s)for(;s.parentId;){const w=c.find(S=>S.id===s.parentId);if(!w)break;s=w,l=w.id}if(!l){alert("لم يتم العثور على القسم الرئيسي لهذا العنصر.");return}const a=(T=q.categoriesFavoriteFolders)==null?void 0:T[l];if(!a){alert(`الرجاء تحديد مجلد المفضلة لهذا القسم في لوحة التحكم أولاً.
قسم الإعدادات -> إعدادات مجلد المفضلة.`),ft(!0);return}if(a===t.categoryId){alert("العنصر موجود بالفعل في مجلد المفضلة هذا.");return}if(f.some(w=>w.url===t.url&&w.categoryId===a)){alert("هذا العنصر موجود بالفعل في المفضلة.");return}const d={...t,id:`fav_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,categoryId:a,timestamp:Date.now()};g(w=>[...w,d]);const b=((I=c.find(w=>w.id===a))==null?void 0:I.name)||"المفضلة";alert(`تم نسخ العنصر إلى "${b}" بنجاح.`)},[c,q.categoriesFavoriteFolders,f]),{repositionModalsForPreview:ml}=qs(),ga=()=>{ft(!1),Et(!1)},ya=o.useCallback(t=>{H(t),ft(!0),Et(!0),ml()},[ml]),wa=o.useCallback(t=>{L(s=>{const l=s.filter(a=>a.playlistId!==t);return l.length===0?(O(-1),W(!1)):$>=l.length&&O(l.length-1),l})},[$]),ja=o.useCallback(t=>{O(t),W(!0),se("playlist"),H(null)},[]),Na=o.useCallback((t,s)=>{L(l=>{const a=[...l];if(s<0||s>=a.length)return a;const[u]=a.splice(t,1);return a.splice(s,0,u),$===t?O(s):$>t&&$<=s?O(d=>d-1):$<t&&$>=s&&O(d=>d+1),a})},[$]),va=()=>{confirm("هل أنت متأكد من حذف كل الفيديوهات؟")&&g([])},hl=()=>{confirm("هل أنت متأكد من مسح قائمة التشغيل الحالية؟")&&(te==="playlist"?(L([]),se("quickList"),Oe.length>0?(O(0),W(!0)):window.location.reload()):L([]))},ka=t=>{if(t.preventDefault(),!!Tt.trim())if(Yt==="google"){const s=`https://www.google.com/search?q=${encodeURIComponent(Tt)}&igu=1`,a={...{id:"google-search-"+Date.now(),title:`Google: ${Tt}`,url:s,timestamp:Date.now(),categoryId:"default"},playlistId:"temp_"+Date.now()};L(u=>[a,...u]),O(0),se("playlist"),W(!0),Vt(!1),Ns("")}else{const s=f.filter(l=>l.title&&l.title.toLowerCase().includes(Tt.toLowerCase())||l.url&&l.url.toLowerCase().includes(Tt.toLowerCase()));Js(s)}},Ca=t=>{const s={...t,playlistId:"search_"+Date.now()};L(l=>[s,...l]),O(0),se("playlist"),W(!0),Vt(!1),Ns(""),Js([])},Sa=async()=>{const t=await ur(),l=JSON.stringify({categories:c,repository:f,playlist:P,settings:q,savedPlaylists:t},null,2),a=new Blob([l],{type:"application/json"}),u=URL.createObjectURL(a),d=document.createElement("a"),b=confirm(`هل تريد حفظ الملف باسم "video-station-data.json" مباشرة؟
(موافق: video-station-data.json، إلغاء: video_station_full_data.json)`);d.href=u,d.download=b?"video-station-data.json":"video_station_full_data.json",d.click(),URL.revokeObjectURL(u),alert("تم تصدير جميع بيانات التطبيق بنجاح!")},pl=async t=>{try{let l=new URL(t).hostname;l=l.replace(/^www\./,"");const a=Ms(t);if(a){const u=`https://i.ytimg.com/vi/${a}/hqdefault.jpg`;return{title:`YouTube Video (${a})`,movies_img:u}}return{title:l}}catch{return{title:t.length>50?t.substring(0,50)+"...":t}}},Ia=t=>{var s;try{const l=JSON.parse(t);let a=[];if(Array.isArray(l)?a=l:typeof l=="object"&&l!==null&&(Array.isArray(l.movies_info)?a=l.movies_info:Array.isArray(l.videos)?a=l.videos:Array.isArray(l.items)&&(a=l.items)),a.length>0){const u=a.map(d=>{const b=d.title||d.movies_name||d.series_name||d.name||"فيديو بدون عنوان",T=d.url||d.link||d.movies_href||d.series_href||d.src||"#",I=d.movies_img||d.series_img||d.imageUrl;return{id:d.id||Math.random().toString(36).substr(2,9),title:b,url:T,movies_img:I,timestamp:d.timestamp||Date.now(),categoryId:Ee}});console.log("importJSON: Normalized data for repository:",u),g(d=>[...d,...u]),alert(`تم استيراد ${u.length} فيديو إلى القسم "${((s=c.find(d=>d.id===Ee))==null?void 0:s.name)||"عام"}" بنجاح`),ne(!1)}else alert('لم يتم العثور على بيانات صالحة. تأكد من أن الملف يحتوي على مصفوفة فيديوهات أو كائن "movies_info"')}catch(l){alert("خطأ في صيغة JSON: "+l.message)}},Pa=async()=>{if(!window.showOpenFilePicker){alert("متصفحك لا يدعم واجهة برمجة تطبيقات File System Access API. يرجى استخدام أحدث إصدار من Chrome أو Edge.");return}try{const[t]=await window.showOpenFilePicker({types:[{description:"JSON Files",accept:{"application/json":[".json"]}}],multiple:!1}),s=await t.getFile(),l=await s.text();try{const a=JSON.parse(l);if(a.categories&&x(a.categories),a.repository){const u=a.repository.map(d=>({...d,categoryId:d.categoryId||"default"}));g(u)}a.playlist&&L(a.playlist),a.settings&&Be({...a.settings,selectedCategories:a.settings.selectedCategories||["default"]}),a.savedPlaylists&&M(a.savedPlaylists),Us(t),alert(`تم تحميل البيانات بنجاح من ملف: ${s.name}`)}catch(a){console.error("Failed to parse selected JSON:",a),alert("خطأ في تحليل ملف JSON المحدد.")}}catch(t){t.name==="AbortError"?console.log("User cancelled file picker."):(console.error("Error opening file picker:",t),alert("فشل في فتح منتقي الملفات أو قراءة الملف."))}},Ea=t=>{const s=t.indexOf("@");if(s===-1)return null;const l=t.lastIndexOf(".");let a=l!==-1?t.substring(s+1,l):t.substring(s+1);const u=/_\d+items$/;u.test(a)&&(a=a.replace(u,""));const d=/_items$/;return d.test(a)&&(a=a.replace(d,"")),a},bl=async t=>{var w;const s=t.target.files;if(!s||s.length===0)return;const l=(w=document.getElementById("create-category-per-file-checkbox"))==null?void 0:w.checked;let a=0,u=0;const d=S=>new Promise(F=>{const Ne=new FileReader,ee=l?Ea(S.name):null;Ne.onload=Q=>{var ie;try{const et=(ie=Q.target)==null?void 0:ie.result,Se=JSON.parse(et);let gt=[];Array.isArray(Se)?gt=Se:typeof Se=="object"&&Se!==null&&(Array.isArray(Se.movies_info)?gt=Se.movies_info:Array.isArray(Se.videos)?gt=Se.videos:Array.isArray(Se.items)&&(gt=Se.items));const $a=gt.map(Ie=>{const Aa=Ie.title||Ie.movies_name||Ie.series_name||Ie.name||"فيديو بدون عنوان",Ra=Ie.url||Ie.link||Ie.movies_href||Ie.series_href||Ie.src||"#",Oa=Ie.movies_img||Ie.series_img||Ie.imageUrl;return{id:Ie.id||Math.random().toString(36).substr(2,9),title:Aa,url:Ra,movies_img:Oa,timestamp:Ie.timestamp||Date.now(),categoryId:""}});F({videos:$a,categoryName:ee})}catch(et){console.error(`Error parsing file ${S.name}:`,et),F({videos:[],categoryName:null})}},Ne.onerror=()=>F({videos:[],categoryName:null}),Ne.readAsText(S)}),b=await Promise.all(Array.from(s).map(d));let T=[],I=[...c];b.forEach(S=>{if(S.videos.length>0){u++,a+=S.videos.length;let F=Ee;if(S.categoryName){const ee=I.find(Q=>Q.name===S.categoryName);if(ee)F=ee.id;else{const Q={id:`cat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,name:S.categoryName,type:"websites",parentId:l&&Ee!=="default"?Ee:void 0};I.push(Q),F=Q.id}}const Ne=S.videos.map(ee=>({...ee,categoryId:F}));T.push(...Ne)}}),g(S=>[...S,...T]),x(I),a>0?alert(`تم بنجاح استيراد ${a} فيديو من ${u} ملفات.`):alert("لم يتم استيراد أي بيانات صالحة من الملفات المحددة."),ne(!1),t.target&&(t.target.value="")},rs=o.useCallback(t=>{se("quickList"),ys(s=>{const l=s.findIndex(u=>u.id===t.id);let a=[...s];return l!==-1&&a.splice(l,1),a.unshift(t),a}),O(0),W(!0),H(null)},[]),Is=(t,s)=>{ks(s),t.dataTransfer.effectAllowed="move"},Ps=t=>{t.preventDefault()},Es=(t,s)=>{if(!ts)return;const l=Fe(ts.id,c);if(ts.id===s.id||l.has(s.id)){ks(null);return}const a=c.map(u=>u.id===ts.id?{...u,parentId:s.id}:u);x(a),ks(null)},Ms=t=>{if(!t)return null;let s=null;const l=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)([\w-]{11})/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([\w-]{11})/];try{for(const a of l){const u=t.match(a);if(u&&u[1]){s=u[1];break}}return s}catch(a){return console.error("Error parsing YouTube URL:",a),null}},fl=t=>{if(!t)return null;let s=null;const l=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)([\w-]{11})/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([\w-]{11})/];try{for(const a of l){const u=t.match(a);if(u&&u[1]){s=u[1];break}}return s?`https://www.youtube.com/embed/${s}?autoplay=1&enablejsapi=1&origin=${window.location.origin}`:null}catch(a){return console.error("Error parsing YouTube URL:",a),null}},Ma=o.useRef(null),os=o.useCallback(t=>{if(je.current)try{const s=je.current.contentWindow;if(!s)return;switch(t){case"back":s.history.back();break;case"forward":s.history.forward();break;case"reload":s.location.reload();break;case"home":v!=null&&v.url&&(je.current.src=v.url,Ht(v.url),Kt(v.url));break}}catch(s){console.error("Navigation error:",s)}},[v]),Ta=o.useCallback(t=>{if(t.preventDefault(),!je.current||!Qe.trim())return;let s=Qe.trim();s.match(/^https?:\/\//i)||(s="https://"+s),je.current.src=s,Ht(s)},[Qe]);o.useCallback(()=>{if(!(!je.current||!confirm(`⚠️ تنبيه:

ملء الشاشة للإطار له قيود:
• لن تتمكن من تكبير الفيديو الداخلي
• قد لا تعمل بعض الأزرار داخل الصفحة

✅ للتحكم الكامل، استخدم زر "النافذة المنفصلة" (الزر الأخضر)

هل تريد المتابعة مع ملء الشاشة للإطار؟`)))try{je.current.requestFullscreen&&je.current.requestFullscreen()}catch(s){console.error("Fullscreen error:",s),alert("فشل تفعيل ملء الشاشة. استخدم زر النافذة المنفصلة (الأخضر) بدلاً من ذلك.")}},[]),o.useCallback(()=>{if(!(v!=null&&v.url))return;const t=window.screen.width*.9,s=window.screen.height*.9,l=(window.screen.width-t)/2,a=(window.screen.height-s)/2;window.open(v.url,"VideoPopup",`width=${t},height=${s},left=${l},top=${a},toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes`)},[v]);const gl=()=>{const t=prompt("أدخل اسم قائمة التشغيل الجديدة:");if(t&&t.trim()){const s={id:Math.random().toString(36).substr(2,9),name:t.trim(),items:[...P]};M(l=>[...l,s]),Dl(s),alert("تم حفظ القائمة بنجاح")}},La=()=>{if(Oe.length===0){alert("قائمة التشغيل السريع فارغة!");return}const t=prompt("أدخل اسم قائمة التشغيل الجديدة:");if(t&&t.trim()){const s={id:Math.random().toString(36).substr(2,9),name:t.trim(),items:Oe.map(l=>({...l,playlistId:`pli_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}))};M(l=>[...l,s]),Dl(s),alert("تم حفظ القائمة بنجاح")}},yl=t=>{confirm("هل أنت متأكد من حذف قائمة التشغيل المحفوظة هذه؟")&&(M(s=>s.filter(l=>l.id!==t)),xr(t))},Ts=t=>{const s=R.find(l=>l.id===t);if(s){if(P.length>0&&!confirm("هل تريد استبدال القائمة الحالية؟"))return;L(s.items),se("playlist"),O(0),W(!0)}},wl=zt(c).filter(t=>t.type==="websites"),jl=zt(c).filter(t=>t.type==="elements");return Mt?e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-950 text-white font-sans",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gt,{className:"w-16 h-16 animate-spin mx-auto mb-4 text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"...جاري تحميل البيانات"}),e.jsx("p",{className:"text-lg text-gray-400",children:"قد يستغرق هذا بعض الوقت إذا كان حجم البيانات كبيراً"})]})}):e.jsxs("div",{className:"h-screen flex flex-col overflow-hidden bg-slate-950 text-slate-200",children:[e.jsx("input",{type:"file",ref:Ma,onChange:bl,className:"hidden",accept:".json",multiple:!0}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ns,{className:"text-blue-500"})," استيراد بيانات (JSON)"]}),e.jsx("button",{onClick:()=>ne(!1),className:"text-slate-500 hover:text-slate-300",children:e.jsx(ze,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase tracking-wider",children:"اختر نوع المحتوى للاستيراد"}),e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-lg mb-4",children:[e.jsx("button",{type:"button",onClick:()=>ve("websites"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${$e==="websites"?"bg-blue-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"مواقع"}),e.jsx("button",{type:"button",onClick:()=>ve("elements"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${$e==="elements"?"bg-purple-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"عناصر"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:$e==="websites"?"اختر قسم المواقع":"اختر قسم العناصر"}),e.jsx("select",{value:Ee,onChange:t=>wt(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 text-sm",children:zt(c).filter(t=>t.type===$e).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),hs==="json"&&e.jsxs("div",{id:"json-import-tab",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"لصق محتوى JSON أو ارفع ملفات."}),e.jsx("textarea",{id:"import-text",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 h-32 text-xs font-mono",placeholder:'[{"title": "...", "url": "..."}]'}),e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-3 mb-3",children:[e.jsx("input",{id:"create-category-per-file-checkbox",type:"checkbox",className:"w-4 h-4 rounded border-slate-700 bg-slate-900 text-blue-500 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"create-category-per-file-checkbox",className:"text-slate-400 select-none",children:"إنشاء قسم لكل ملف (من اسم الملف)"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{const t=document.getElementById("import-text").value;t&&t.trim().length>0?Ia(t):alert("الرجاء لصق كود JSON أولاً")},className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"استيراد النص"}),e.jsxs("label",{className:"flex-1 cursor-pointer bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-purple-600/20 flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5"}),e.jsx("span",{children:"رفع ملفات"}),e.jsx("input",{type:"file",className:"hidden",accept:".json",multiple:!0,onChange:bl})]})]})]})]})}),e.jsxs("header",{className:`bg-slate-900/80 backdrop-blur-md border-b border-slate-800 py-0 px-1 flex items-center justify-between z-20 transition-all duration-300 ${oe?"hidden":""}`,children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-cyan-400 p-0.5 rounded-md shadow-lg shadow-blue-500/20",children:e.jsx(tt,{className:"w-3 h-3 text-white fill-current"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-black text-sm tracking-tight bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent",children:"محطة الفيديو الذكية"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] text-slate-500 font-medium",children:[e.jsx("span",{className:"bg-slate-800/50 px-1 py-0.25 rounded",children:"v2.1"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[f.length," فيديو"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>Vt(!0),className:"flex items-center gap-1 bg-purple-600 hover:bg-purple-500 text-white px-1.5 py-0.5 rounded-md text-[10px] font-bold shadow-lg shadow-purple-600/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(is,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"بحث"})]}),e.jsxs("button",{onClick:()=>re(!0),className:"flex items-center gap-1 bg-blue-600 hover:bg-blue-500 text-white px-1.5 py-0.5 rounded-md text-[10px] font-bold shadow-lg shadow-blue-600/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(it,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"إضافة فيديو"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 bg-slate-800/50 p-0.5 rounded-md border border-slate-700/50",children:[e.jsxs("button",{onClick:Zs,className:"p-0.5 hover:bg-slate-700 rounded text-slate-300 hover:text-white transition-colors flex items-center gap-0.5",title:"السابق",children:[e.jsx(vl,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] font-bold",children:"السابق"})]}),e.jsx("div",{className:"h-3 w-px bg-slate-700"}),e.jsxs("button",{onClick:Ue,className:"p-0.5 hover:bg-slate-700 rounded text-slate-300 hover:text-white transition-colors flex items-center gap-0.5",title:"التالي",children:[e.jsx("span",{className:"text-[10px] font-bold",children:"التالي"}),e.jsx(kl,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>j(!p),className:`p-0.5 rounded-md transition-all ${p?"bg-orange-600/20 text-orange-400":"hover:bg-slate-800 text-orange-400"}`,title:"القائمة السريعة",children:e.jsx(Ba,{className:"w-3.5 h-3.5 text-orange-400"})}),p&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-96 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-slate-800 font-bold text-xs text-slate-400",children:"الوصول السريع"}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1",children:te==="quickList"&&Oe.length>0||De.length>0?(te==="quickList"?Oe:De).slice(0,10).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsxs("button",{onClick:()=>{se("quickList");const a=(Oe.length>0?Oe:De).findIndex(u=>u.id===t.id);O(a!==-1?a:0),W(!0),j(!1),H(null)},className:`flex-1 text-right text-base p-2 rounded hover:bg-slate-800 truncate ${(v==null?void 0:v.id)===t.id?"text-blue-400 bg-blue-900/10":"text-slate-300"}`,children:[s+1,". ",t.title]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),as(t)},className:"p-1.5 bg-blue-600/20 hover:bg-blue-600/40 rounded-md text-blue-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"إضافة إلى قائمة التشغيل",children:e.jsx(it,{className:"w-3.5 h-3.5"})})]},t.id+"_quick_"+s)):e.jsx("div",{className:"text-center text-xs text-slate-500 py-4",children:"لا توجد عناصر في القائمة الحالية"})})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:()=>qe("list"),className:`p-0.5 rounded-md transition-all ${Ce==="list"?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800"}`,title:"عرض كقائمة",children:e.jsx(us,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>qe("grid"),className:`p-0.5 rounded-md transition-all ${Ce==="grid"?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800"}`,title:"عرض كشبكة (بطاقات)",children:e.jsx(Ds,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsx("button",{onClick:()=>{v!=null&&v.url&&Xs(v.url)},disabled:!v,className:"p-0.5 rounded-md text-slate-400 hover:bg-slate-800 hover:text-blue-400 transition-all disabled:opacity-30 disabled:cursor-not-allowed",title:"فتح في نافذة خارجية",children:e.jsx(Cl,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable full-screen mode:",t.message)})},className:"flex items-center gap-1 bg-slate-800/50 hover:bg-slate-700/80 text-slate-300 px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-700 hover:border-slate-600",title:"تبديل وضع ملء الشاشة",children:[e.jsx(Ua,{className:"w-3 h-3"}),e.jsx("span",{children:"ملء الشاشة"})]}),e.jsxs("button",{onClick:()=>ft(!0),className:"flex items-center gap-1 bg-gradient-to-r from-slate-800 to-slate-700 hover:from-slate-700 hover:to-slate-600 text-white px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-600 shadow-lg",children:[e.jsx(Ds,{className:"w-3 h-3"}),e.jsx("span",{children:"لوحة التحكم"})]}),e.jsxs("button",{onClick:()=>{const t=q.startupMode==="playlist"?"repository":"playlist";Be(s=>({...s,startupMode:t})),alert(`تم تعيين وضع التشغيل الافتراضي إلى: ${t==="playlist"?"قائمة التشغيل":"قائمة التشغيل السريعة"}`)},className:"flex items-center gap-1 bg-slate-800 hover:bg-slate-700 text-slate-300 px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-700 hover:border-slate-600",title:"تبديل وضع التشغيل الافتراضي عند بدء التشغيل",children:[q.startupMode==="playlist"?e.jsx(us,{className:"w-3 h-3"}):e.jsx(za,{className:"w-3 h-3"}),e.jsxs("span",{className:q.startupMode==="playlist"?"text-green-500":"text-red-500",children:["وضع البدء: ",q.startupMode==="playlist"?"قائمة التشغيل":"تشغيل سريع"]})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:Pa,className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-purple-400 transition-colors",title:"تحميل بيانات مخصصة",children:e.jsx(ns,{className:"w-3 h-3"})}),e.jsx("button",{onClick:Sa,className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-green-400 transition-colors",title:"تصدير نسخة",children:e.jsx(Ga,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>ne(!0),className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-blue-400 transition-colors",title:"استيراد (إضافة لبيانات حالية)",children:e.jsx(ns,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Gs(!js),className:`p-0.5 rounded-md transition-all ${js?"bg-blue-600/20 text-blue-400":"hover:bg-slate-800 text-slate-400"}`,title:"سجل المشاهدة",children:e.jsx(Wa,{className:"w-3.5 h-3.5"})}),js&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-80 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-800 font-bold text-xs text-slate-400 flex justify-between items-center",children:[e.jsx("span",{children:"سجل المشاهدة"}),e.jsx("button",{onClick:()=>{confirm("هل تريد مسح سجل المشاهدة بالكامل؟")&&ws([])},className:"text-red-400 hover:text-red-300 text-xs",children:"مسح الكل"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto p-1",children:zs.length>0?zs.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 group p-2 hover:bg-slate-800 rounded",children:[e.jsx("button",{onClick:()=>{rs(t),Gs(!1)},className:"flex-1 text-right text-xs truncate text-slate-300 hover:text-white",children:t.title}),e.jsx("button",{onClick:()=>as(t),className:"p-1.5 bg-blue-600/20 hover:bg-blue-600/40 rounded-md text-blue-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"إضافة إلى قائمة التشغيل",children:e.jsx(it,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>{confirm("حذف هذا الفيديو من السجل؟")&&ws(l=>l.filter((a,u)=>u!==s))},className:"p-1.5 bg-red-600/20 hover:bg-red-600/40 rounded-md text-red-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"حذف",children:e.jsx(be,{className:"w-3.5 h-3.5"})})]},t.id+"_history_"+s)):e.jsx("div",{className:"text-center text-xs text-slate-500 py-4",children:"لا يوجد سجل مشاهدة"})})]})]})]})]}),oe&&Je&&e.jsxs("div",{className:"fixed top-0 left-0 right-0 p-4 z-50 flex justify-between items-center bg-gradient-to-b from-black/70 to-transparent",children:[e.jsx("div",{}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center gap-2 bg-black/50 rounded-full px-3 py-1 backdrop-blur-sm border border-white/10 shadow-xl",children:[e.jsx("span",{className:"text-xs text-slate-400 font-bold mr-2 hidden sm:inline",children:"Zoom:"}),e.jsx("button",{onClick:oa,className:"p-1.5 hover:bg-white/20 text-blue-400 rounded-full transition-colors",title:"Auto Crop / Smart Zoom",children:e.jsx(Ja,{className:"w-4 h-4"})}),e.jsx("div",{className:"h-4 w-px bg-white/20 mx-1"}),e.jsx("button",{onClick:()=>Re(!Y),className:`p-1.5 hover:bg-white/20 rounded-full transition-colors ${Y?"text-green-400 bg-white/10":"text-slate-300"}`,title:"Manual Crop Mode",children:e.jsx(Xa,{className:"w-4 h-4"})}),(Y||me!==1)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:sl,className:"p-1.5 hover:bg-white/20 text-slate-300 rounded-full transition-colors",children:e.jsx(Sl,{className:"w-3 h-3"})}),e.jsxs("span",{className:"text-xs text-white w-8 text-center",children:[Math.round(me*100),"%"]}),e.jsx("button",{onClick:tl,className:"p-1.5 hover:bg-white/20 text-slate-300 rounded-full transition-colors",children:e.jsx(it,{className:"w-3 h-3"})}),e.jsx("button",{onClick:ll,className:"p-1.5 hover:bg-white/20 text-red-300 rounded-full transition-colors",title:"Reset",children:e.jsx(Gt,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Zs,className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"السابق",children:e.jsx(vl,{className:"w-5 h-5"})}),e.jsx("button",{onClick:Ue,className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"التالي",children:e.jsx(kl,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>de(t=>!t),className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"قائمة التشغيل",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>lt(t=>!t),className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"المستودع / القائمة السريعة",children:e.jsx(Ls,{className:"w-5 h-5"})})]})]}),oe&&!Je&&e.jsx("div",{className:"fixed top-0 left-0 right-0 h-4 z-50 hover:h-16 transition-all duration-300 flex justify-center items-start pt-1",onMouseEnter:()=>Me(!0),children:e.jsx("div",{className:"w-24 h-1 bg-slate-700/50 rounded-full"})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[Ae&&e.jsxs("aside",{className:`
            flex flex-col border-r border-slate-800 bg-slate-900/80 backdrop-blur-sm shrink-0 transition-all duration-300
            ${ye?"fixed inset-0 z-50 w-full h-full":Ce==="list"?"w-96":"w-[60vw]"}
          `,children:[e.jsxs("div",{className:"p-3 border-b border-slate-800 flex items-center justify-between sticky top-0 bg-slate-900/95 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-300",children:[e.jsx(Ls,{className:"w-4 h-4"}),e.jsxs("span",{children:["المستودع (",f.length,")"]}),he.length>0&&e.jsxs("span",{className:"bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full",children:[he.length," محدد"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[ye&&e.jsx("button",{onClick:()=>Rt(null),className:"p-1.5 bg-green-600/20 hover:bg-green-600/40 text-green-300 rounded",title:"العودة للحالة العادية",children:e.jsx($s,{className:"w-5 h-5"})}),!ye&&e.jsx("button",{onClick:()=>Rt("all"),className:"p-1.5 hover:bg-blue-900/30 text-blue-400 rounded transition-colors",title:"فتح في ملء الشاشة",children:e.jsx(Il,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>rt(t=>t==="websites"?"elements":"websites"),className:"p-1.5 hover:bg-slate-800 rounded text-xs font-mono text-slate-500 hover:text-white transition-colors",title:"تغيير العرض",children:e.jsx("span",{className:"text-red-500",children:Ot==="websites"?"مواقع":"عناصر"})}),he.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Et(!0),className:"p-1.5 hover:bg-blue-900/30 text-blue-400 rounded transition-colors",title:`نقل ${he.length} عنصر`,children:e.jsx(Pe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>{confirm(`هل تريد حذف ${he.length} عنصر؟`)&&(dl(he),Ye([]))},className:"p-1.5 hover:bg-red-900/30 text-red-400 rounded transition-colors",title:`حذف ${he.length} عنصر`,children:e.jsx(be,{className:"w-3.5 h-3.5"})})]}),e.jsx("button",{onClick:va,className:"p-1.5 hover:bg-red-900/30 text-slate-500 hover:text-red-400 rounded transition-colors",title:"حذف الكل",children:e.jsx(be,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>lt(!1),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 transition-colors",children:e.jsx(ze,{className:"w-4 h-4"})})]})]}),e.jsx("div",{dir:"rtl",className:"flex-1 overflow-y-auto p-2 space-y-4 custom-scrollbar-left",children:c.filter(t=>!t.parentId&&t.type===Ot).sort((t,s)=>(t.order??0)-(s.order??0)).map(t=>{var u;if(ye&&ye!=="all"&&ye!==t.id||q.displayMode==="family"&&((u=q.hiddenCategories)!=null&&u.includes(t.id)))return null;let s=f.filter(d=>d.categoryId===t.id);switch(q.itemsSortOrder){case"newest":s=s.sort((d,b)=>b.timestamp-d.timestamp);break;case"oldest":s=s.sort((d,b)=>d.timestamp-b.timestamp);break;case"alphabetical":s=s.sort((d,b)=>d.title.localeCompare(b.title));break;case"random":s=s.sort(()=>.5-Math.random());break}const l=c.filter(d=>d.parentId===t.id),a=Zt[t.id]||50;return e.jsxs("div",{className:"space-y-1",onDragOver:Ps,onDrop:d=>Es(d,t),children:[e.jsxs("div",{className:"flex items-center justify-between group sticky top-0 bg-slate-900/90 backdrop-blur-sm py-2 z-10 cursor-move",draggable:!0,onDragStart:d=>Is(d,t),children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-blue-400 transition-colors",onClick:()=>ol(t.id),children:[ge.includes(t.id)?e.jsx(Pl,{className:"w-3 h-3 text-slate-500"}):e.jsx(El,{className:"w-3 h-3 text-slate-500"}),e.jsxs("h3",{className:`font-bold uppercase tracking-wider flex items-center gap-2 ${t.parentId?"text-xs text-slate-400":"text-base text-blue-300"}`,children:[t.id==="default"?e.jsx(Ml,{className:"w-4 h-4"}):e.jsx(Pe,{className:"w-4 h-4"}),t.name,e.jsx("span",{className:"bg-slate-800 px-1.5 rounded-full text-[9px] min-w-[1.5rem] text-center",children:ua(t.id)})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>Rt(t.id),className:"p-1 hover:bg-blue-900/30 text-slate-600 hover:text-blue-400 rounded",title:"ملء الشاشة للقسم",children:e.jsx(Il,{className:"w-3 h-3"})}),t.id!=="default"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>il(t.id),className:"p-1 hover:bg-green-900/30 text-slate-600 hover:text-green-400 rounded",children:e.jsx(tt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>ha(t.id),className:"p-1 hover:bg-purple-900/30 text-slate-600 hover:text-purple-400 rounded",children:e.jsx(yt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>ca(t.id),className:"p-1 hover:bg-red-900/30 text-slate-600 hover:text-red-400 rounded",children:e.jsx(be,{className:"w-3 h-3"})})]})]})]}),ge.includes(t.id)&&e.jsxs("div",{className:`
                          ${ye?"flex flex-col gap-4 p-4":Ce==="grid"?"flex flex-wrap gap-2 p-2":"pl-3 border-l py-1 border-slate-800 ml-1.5"}
                          ${Ce==="grid"&&!ye?"pl-0 ml-0 border-l-0":""}
                        `,children:[l.sort((d,b)=>(d.order??0)-(b.order??0)).map(d=>{var I;if(q.displayMode==="family"&&((I=q.hiddenCategories)!=null&&I.includes(d.id)))return null;let b=f.filter(w=>w.categoryId===d.id);switch(q.itemsSortOrder){case"newest":b=b.sort((w,S)=>S.timestamp-w.timestamp);break;case"oldest":b=b.sort((w,S)=>w.timestamp-S.timestamp);break;case"alphabetical":b=b.sort((w,S)=>w.title.localeCompare(S.title));break;case"random":b=b.sort(()=>.5-Math.random());break}const T=ge.includes(d.id);return e.jsxs("div",{className:"w-full flex flex-col",onDragOver:Ps,onDrop:w=>Es(w,d),children:[e.jsxs("div",{className:`flex items-center justify-between group py-2 ${Ce==="grid"&&!ye?"px-2":"px-3"} bg-slate-800/50 rounded cursor-move`,draggable:!0,onDragStart:w=>Is(w,d),children:[e.jsxs("div",{className:"flex items-center gap-2 text-base text-yellow-400 cursor-pointer hover:text-blue-400 transition-colors",onClick:()=>ol(d.id),children:[T?e.jsx(Pl,{className:"w-4 h-4 text-slate-500"}):e.jsx(El,{className:"w-4 h-4 text-slate-500"}),e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:d.name}),e.jsxs("span",{className:"text-xs opacity-50",children:["(",b.length,")"]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),il(d.id)},className:"p-1.5 hover:bg-green-900/30 text-slate-600 hover:text-green-400 rounded",children:e.jsx(tt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),nl(d.id)},className:"p-1.5 hover:bg-red-900/30 text-slate-600 hover:text-red-400 rounded",children:e.jsx(be,{className:"w-3.5 h-3.5"})})]})]}),T&&e.jsx("div",{className:ye?"grid grid-cols-4 gap-3 p-4":Ce==="grid"?"grid grid-cols-2 gap-2 p-2 pl-0 ml-0 border-l-0":"",children:b.map((w,S)=>e.jsx("div",{className:"w-full",children:e.jsx(Fl,{itemIndex:S,vid:w,currentVideoId:v==null?void 0:v.id,categories:c,onVideoClick:rl,onPreview:al,onPlayNow:rs,onAddToPlaylist:as,onEdit:Ss,onDelete:cl,onMoveToTop:ul,onAddToFavorites:xl,viewMode:Ce,isSelected:he.includes(w.id),setItemRef:F=>ss.current[w.id]=F})},w.id))})]},d.id)}),e.jsxs("div",{className:ye?"grid grid-cols-4 gap-3 p-4":Ce==="grid"?"grid grid-cols-2 gap-2 p-2 pl-0 ml-0 border-l-0":"",children:[s.slice(0,a).map((d,b)=>e.jsx("div",{className:"w-full",children:e.jsx(Fl,{itemIndex:b,vid:d,currentVideoId:v==null?void 0:v.id,categories:c,onVideoClick:rl,onPreview:al,onPlayNow:rs,onAddToPlaylist:as,onEdit:Ss,onDelete:cl,onMoveToTop:ul,onAddToFavorites:xl,viewMode:Ce,isSelected:he.includes(d.id),setItemRef:T=>ss.current[d.id]=T})},d.id)),s.length>a&&e.jsxs("button",{onClick:()=>qt(d=>({...d,[t.id]:a+50})),className:"w-full text-center text-xs text-blue-400 hover:text-blue-300 py-1",children:["عرض المزيد (",s.length-a," متبقي)"]})]})]})]},t.id)})})]}),!Xe&&e.jsx("button",{onClick:()=>de(!0),className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-30 p-2 bg-slate-800/90 hover:bg-slate-700 rounded-r-lg transition-colors shadow-lg",title:"إظهار قائمة التشغيل",children:e.jsx(yt,{className:"w-5 h-5 text-slate-300"})}),e.jsx("main",{className:"flex-1 flex flex-col bg-black relative",children:e.jsx(jr,{children:e.jsx("div",{className:"flex-1 relative group w-full h-full flex items-center justify-center bg-zinc-950",children:v?e.jsx("div",{className:"w-full h-full relative",children:fl(v.url)?e.jsx("div",{id:"youtube-player-container",className:"w-full h-full"}):v.url.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{className:"w-full h-full object-contain",src:v.url,controls:!0,autoPlay:q.autoPlay,muted:q.startMuted,loop:q.loop,onEnded:()=>q.autoPlay&&Ue(),onError:()=>{console.error("Error playing direct video, skipping to next."),Ue()}}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"bg-slate-800 p-2 flex items-center gap-2 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center bg-slate-900 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>os("back"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",disabled:!pt,children:e.jsx($s,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>os("forward"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",disabled:!Qt,children:e.jsx(Tl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>os("reload"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",children:e.jsx(Gt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>os("home"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",children:e.jsx(Ml,{className:"w-3.5 h-3.5"})})]}),e.jsxs("form",{onSubmit:Ta,className:"flex-1 flex items-center gap-2 bg-slate-900 rounded-lg px-3 py-1.5 border border-slate-700 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500 transition-all",children:[e.jsx("div",{className:"text-slate-500",children:e.jsx(is,{className:"w-3.5 h-3.5"})}),e.jsx("input",{type:"text",value:Qe,onChange:t=>Kt(t.target.value),className:"flex-1 bg-transparent border-none outline-none text-xs font-mono text-slate-300 placeholder-slate-600",placeholder:"Search or enter URL..."}),(v==null?void 0:v.url)!==Qe&&e.jsx("button",{type:"submit",className:"text-blue-500 hover:text-blue-400 text-[10px] font-bold uppercase",children:"Go"}),e.jsx("button",{type:"button",onClick:()=>_t(!0),className:"text-slate-500 hover:text-green-400",title:"حفظ الرابط الحالي",children:e.jsx(Ll,{className:"w-3.5 h-3.5"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden bg-white relative",onMouseDown:Y?Zl:la,onMouseMove:Y?ea:aa,onMouseUp:Y?Ks:Qs,onMouseLeave:Y?Ks:Qs,style:{cursor:Y?"crosshair":B&&!Y?mt?"grabbing":"grab":"default"},children:[e.jsx("iframe",{ref:je,className:"w-full h-full",style:{transform:B?`translate(${ue.x}px, ${ue.y}px) scale(${me*Ct}, ${me*ps})`:`scale(${me})`,transformOrigin:"0 0",border:"none",pointerEvents:Y||mt?"none":"auto",transition:mt?"none":"transform 0.3s ease-out"},src:Ql(v.url),title:v.title,sandbox:"allow-scripts allow-same-origin allow-presentation allow-forms allow-modals",allow:"fullscreen; autoplay; encrypted-media; picture-in-picture; display-capture; web-share"}),Y&&k&&e.jsx("div",{className:"absolute pointer-events-none z-40",style:{left:`${k.x}%`,top:`${k.y}%`,width:`${k.width}%`,height:`${k.height}%`,border:"3px dashed #f59e0b",backgroundColor:"rgba(245, 158, 11, 0.15)",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 flex gap-2 pointer-events-auto",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),ta()},className:"bg-green-600 hover:bg-green-500 text-white p-2 rounded-full shadow-lg transition-transform hover:scale-110",title:"تأكيد القص",children:e.jsx(ds,{className:"w-5 h-5"})}),e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),sa()},className:"bg-red-600 hover:bg-red-500 text-white p-2 rounded-full shadow-lg transition-transform hover:scale-110",title:"إلغاء",children:e.jsx(ze,{className:"w-5 h-5"})})]})}),Y&&h&&D&&e.jsx("div",{className:"absolute pointer-events-none",style:{left:`${Math.min(h.x,D.x)}%`,top:`${Math.min(h.y,D.y)}%`,width:`${Math.abs(D.x-h.x)}%`,height:`${Math.abs(D.y-h.y)}%`,border:"3px dashed #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",boxShadow:k?"none":"0 0 0 9999px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"absolute -bottom-8 left-0 bg-blue-600 text-white text-xs px-2 py-1 rounded",children:[Math.round(Math.abs(D.x-h.x)),"% × ",Math.round(Math.abs(D.y-h.y)),"%"]})}),Y&&!h&&!k&&e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",children:[e.jsx(Ha,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:"اسحب لرسم المستطيل"})]})]}),!G&&(B&&!Y||me!==1&&!Y)&&e.jsx("button",{onClick:()=>le(!0),className:"absolute bottom-8 right-8 bg-slate-900/80 backdrop-blur text-white p-3 rounded-full shadow-lg border border-slate-700 hover:bg-blue-600 transition-all z-50 animate-pulse",title:"إظهار أدوات التحكم",children:e.jsx(Ka,{className:"w-6 h-6"})}),G&&(B&&!Y||me!==1&&!Y)&&e.jsxs("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 bg-slate-900/95 backdrop-blur-md border border-slate-700 rounded-2xl p-4 shadow-2xl z-50",children:[e.jsx("button",{onClick:()=>le(!1),className:"absolute -top-3 -right-3 bg-slate-800 text-slate-400 hover:text-white hover:bg-red-600 rounded-full p-1 shadow-md border border-slate-700 transition-colors",title:"إخفاء الأدوات",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-center text-xs font-bold text-slate-400 uppercase tracking-wider mb-1",children:"ضبط يدوي"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("button",{onClick:()=>ls("up"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لأعلى",children:e.jsx(Bl,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ls("left"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لليسار",children:e.jsx(Tl,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-2 bg-slate-950 rounded-lg",children:e.jsx(Qa,{className:"w-5 h-5 text-slate-500"})}),e.jsx("button",{onClick:()=>ls("right"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لليمين",children:e.jsx($s,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>ls("down"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لأسفل",children:e.jsx(Ul,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-px bg-slate-700 my-1"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:sl,className:"p-2 bg-slate-800 hover:bg-purple-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تصغير",children:e.jsx(Sl,{className:"w-4 h-4"})}),e.jsx("div",{className:"px-3 py-1 bg-slate-950 rounded-lg min-w-[60px] text-center",children:e.jsxs("span",{className:"text-sm font-bold text-blue-400",children:[Math.round(me*100),"%"]})}),e.jsx("button",{onClick:tl,className:"p-2 bg-slate-800 hover:bg-purple-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تكبير",children:e.jsx(it,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:ll,className:"w-full py-2 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white rounded-lg transition-all flex items-center justify-center gap-2 text-sm font-bold",title:"إعادة تعيين",children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsx("span",{children:"إعادة تعيين"})]})]})]})]})}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-700",children:[e.jsx(tt,{className:"w-20 h-20 mb-4 opacity-10"}),e.jsx("p",{className:"text-lg font-medium opacity-50",children:ce==="playlist"?"القائمة فارغة، أضف فيديوهات":"اختر أقساماً للتشغيل من المستودع"})]})})})}),!Ae&&e.jsx("button",{onClick:()=>lt(!0),className:"fixed right-0 top-1/2 transform -translate-y-1/2 z-30 p-2 bg-slate-800/90 hover:bg-slate-700 rounded-l-lg transition-colors shadow-lg",title:"إظهار المستودع",children:e.jsx(Ls,{className:"w-5 h-5 text-slate-300"})}),Xe&&e.jsxs("aside",{className:"relative w-72 border-l border-slate-800 bg-slate-900/50 flex flex-col shrink-0",children:[e.jsx("button",{onClick:()=>de(!1),className:"absolute top-1/2 right-0 transform translate-x-1/2 -translate-y-1/2 z-30 p-2 bg-green-800/90 hover:bg-green-700 rounded-full transition-colors shadow-lg text-white",title:"إخفاء قائمة التشغيل",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-300",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{children:"قائمة التشغيل"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:gl,className:"text-[10px] text-green-400 hover:text-white border border-slate-700 hover:border-green-800 hover:bg-green-900/50 px-2 py-0.5 rounded transition-colors flex items-center gap-1",title:"حفظ القائمة الحالية",children:[e.jsx(_s,{className:"w-3 h-3"})," حفظ"]}),e.jsxs("button",{onClick:()=>xe(!0),className:"text-[10px] text-slate-300 hover:text-white border border-slate-700 hover:bg-slate-800 px-2 py-0.5 rounded transition-colors flex items-center gap-1",title:"إدارة القوائم المحفوظة",children:[e.jsx($l,{className:"w-3 h-3"})," إدارة"]}),e.jsx("button",{onClick:hl,className:"text-[10px] text-slate-500 hover:text-red-400 transition-colors",title:"مسح القائمة الحالية",children:"مسح"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:P.length===0?e.jsx("div",{className:"h-40 flex flex-col items-center justify-center text-slate-500 text-sm text-center px-4",children:e.jsx("p",{children:"القائمة فارغة، انقر على أي فيديو من المستودع للإضافة"})}):P.map((t,s)=>e.jsx(Sr,{item:t,index:s,currentIndex:te==="playlist"?$:-1,onPlay:ja,onRemove:wa,onMove:Na},t.playlistId))})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(it,{className:"text-blue-500"})," إضافة فيديو جديد"]}),e.jsx("button",{onClick:()=>re(!1),className:"text-slate-500 hover:text-slate-300",children:e.jsx(ze,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"أقسام المواقع"}),e.jsxs("select",{value:wl.some(t=>t.id===_e)?_e:"",onChange:t=>jt(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"-- اختر قسم مواقع --"}),wl.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"أقسام العناصر"}),e.jsxs("select",{value:jl.some(t=>t.id===_e)?_e:"",onChange:t=>jt(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"-- اختر قسم عناصر --"}),jl.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex border-b border-slate-800 mb-4",children:[e.jsx("button",{onClick:()=>Ge("single"),className:`px-4 py-2 text-sm font-bold transition-colors ${fe==="single"?"text-blue-400 border-b-2 border-blue-400":"text-slate-400 hover:text-white"}`,children:"فيديو واحد"}),e.jsx("button",{onClick:()=>Ge("multiple"),className:`px-4 py-2 text-sm font-bold transition-colors ${fe==="multiple"?"text-blue-400 border-b-2 border-blue-400":"text-slate-400 hover:text-white"}`,children:"روابط متعددة"})]}),fe==="single"&&e.jsxs("form",{onSubmit:ba,className:"space-y-4",children:[e.jsx("input",{type:"hidden",name:"categoryId",value:_e}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الفيديو"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"مثال: فيديو الطبيعة الخلابة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط (Direct / YouTube / Web)"}),e.jsx("input",{name:"url",required:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"حفظ الفيديو"}),e.jsx("button",{type:"button",onClick:()=>re(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]}),fe==="multiple"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"ألصق قائمة بالروابط (كل رابط في سطر جديد). سيتم استخدام اسم الموقع كعنوان."}),e.jsx("textarea",{id:"add-multiple-links-text",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 h-48 text-sm",placeholder:`https://example.com/page1
https://anothersite.net/video
https://www.youtube.com/watch?v=...`}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{const t=document.getElementById("add-multiple-links-text").value;pa(t,_e)},className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-green-600/20",children:"إضافة الروابط"}),e.jsx("button",{type:"button",onClick:()=>re(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),Dt&&we&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Yl,{className:"text-blue-500"})," تعديل بيانات الفيديو"]}),e.jsxs("form",{onSubmit:na,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الفيديو"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,defaultValue:we.title,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"مثال: فيديو الطبيعة الخلابة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط (Direct / YouTube / Web)"}),e.jsx("input",{name:"url",required:!0,defaultValue:we.url,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"القسم"}),e.jsx("select",{name:"categoryId",defaultValue:we.categoryId||"default",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:zt(c).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"حفظ التعديلات"}),e.jsx("button",{type:"button",onClick:()=>{Pt(!1),It(null)},className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),bs&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ll,{className:"text-green-500"})," حفظ الرابط إلى المستودع"]}),e.jsxs("form",{onSubmit:ia,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الصفحة"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"أدخل عنوان الصفحة..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط"}),e.jsx("input",{type:"text",value:Xt||Qe,readOnly:!0,className:"w-full bg-slate-700 border-none rounded-lg p-3 outline-none ring-1 ring-slate-600 text-slate-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"القسم"}),e.jsx("select",{name:"categoryId",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:zt(c).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-green-600/20",children:"حفظ الرابط"}),e.jsx("button",{type:"button",onClick:()=>_t(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx($l,{className:"text-purple-500"})," إدارة قوائم التشغيل"]}),e.jsx("div",{className:"mb-4 space-y-2 max-h-60 overflow-y-auto p-2 bg-slate-800/20 rounded-lg",children:R.length===0?e.jsx("div",{className:"text-center text-slate-500 py-4",children:"لا توجد قوائم محفوظة"}):R.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>Ts(t.id),children:[e.jsx("div",{className:"font-bold text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[t.items.length," فيديو"]})]}),e.jsxs("button",{onClick:()=>Ts(t.id),className:"p-1.5 px-3 bg-green-600/20 hover:bg-green-600/40 rounded-md text-green-300 hover:text-white transition-colors flex items-center gap-1.5 text-xs",title:"فتح القائمة",children:[e.jsx(tt,{className:"w-3 h-3"})," فتح"]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),yl(t.id)},className:"p-1.5 text-slate-500 hover:bg-red-900/30 hover:text-red-400 rounded-md",title:"حذف القائمة",children:e.jsx(be,{className:"w-4 h-4"})})]},t.id))}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:La,className:"flex-1 bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition-all text-xs",children:"حفظ قائمة التشغيل السريع"}),e.jsx("button",{onClick:()=>xe(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-2 rounded-lg transition-all text-xs",children:"إغلاق"})]})})]})}),dt&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-6 overflow-y-auto",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-8 w-full max-w-3xl shadow-2xl text-right",children:[e.jsx("h2",{className:"text-3xl font-black mb-6 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"دليل تشغيل المحطة"}),e.jsxs("div",{className:"space-y-6 text-slate-300",children:[e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"1"}),"المستودع (المخزن الرئيسي)"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:"ابدأ بإضافة روابط الفيديوهات إلى المستودع. يمكنك إضافة روابط مباشرة (mp4, webm)، أو روابط يوتيوب، أو حتى روابط صفحات ويب عادية. المستودع يُحفظ تلقائياً في متصفحك."})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"2"}),"قائمة التشغيل (Playlist)"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:'انقر على الفيديوهات الموجودة في المستودع لإضافتها إلى قائمة التشغيل. سيقوم التطبيق بتشغيل الفيديوهات في القائمة واحداً تلو الآخر بناءً على "المدة" المحددة في الإعدادات.'})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"3"}),"إعدادات التشغيل التلقائي"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:'من الشريط السفلي، حدد مدة عرض كل فيديو. عند تفعيل "تشغيل تلقائي"، سينتقل المشغل للفيديو التالي بمجرد انتهاء الوقت المحدد، حتى لو لم ينتهِ الفيديو الأصلي. هذا مفيد جداً للمراقبة أو العروض التقديمية.'})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-green-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center text-xs",children:"4"}),"ميزات المتصفح المدمج"]}),e.jsx("p",{className:"text-sm leading-relaxed mb-2",children:"عند تشغيل صفحات الويب، يظهر شريط تنقل متقدم يتيح لك:"}),e.jsxs("ul",{className:"text-xs space-y-1 mr-4 list-disc",children:[e.jsx("li",{children:"التنقل للأمام والخلف بين الصفحات"}),e.jsx("li",{children:"تحديث الصفحة أو العودة للصفحة الرئيسية"}),e.jsx("li",{children:"إدخال عنوان URL جديد للتصفح داخل الإطار"}),e.jsx("li",{children:"التحكم في التكبير/التصغير (50% - 300%)"}),e.jsx("li",{children:"تفعيل وضع ملء الشاشة للإطار نفسه (زر Maximize)"}),e.jsx("li",{children:"فتح الرابط في تبويب جديد خارج التطبيق"}),e.jsx("li",{className:"text-green-400 font-bold",children:"⭐ فتح في نافذة منفصلة (زر أخضر) - للتحكم الكامل بالفيديو والروابط!"})]})]}),e.jsxs("section",{className:"bg-gradient-to-br from-purple-900/40 to-pink-900/40 p-5 rounded-2xl border border-purple-500/30",children:[e.jsxs("h3",{className:"font-bold text-purple-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center text-xs",children:"5"}),"⚠️ مشكلة تكبير الفيديو الداخلي والحل"]}),e.jsxs("div",{className:"text-sm leading-relaxed space-y-3",children:[e.jsxs("div",{className:"bg-red-900/30 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-300 font-bold text-xs mb-1",children:"❌ المشكلة:"}),e.jsx("p",{className:"text-xs text-red-200",children:"بسبب قيود أمان المتصفح، لا يمكن تكبير الفيديو الموجود داخل صفحة ويب معروضة في إطار (iframe). عند الضغط على زر ملء الشاشة داخل الفيديو، لن يستجيب."})]}),e.jsxs("div",{className:"bg-green-900/30 border border-green-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-300 font-bold text-xs mb-1",children:"✅ الحل الأمثل:"}),e.jsxs("p",{className:"text-xs text-green-200",children:["استخدم زر ",e.jsx(Za,{className:"w-3 h-3 inline text-green-400"})," ",e.jsx("strong",{className:"text-green-400",children:"(النافذة المنفصلة - الزر الأخضر)"}),"لفتح الصفحة في نافذة متصفح منفصلة. هذا يتيح لك:"]}),e.jsxs("ul",{className:"text-[10px] text-green-100 mt-2 mr-4 space-y-1 list-disc",children:[e.jsx("li",{children:"تكبير الفيديو بملء الشاشة بشكل طبيعي"}),e.jsx("li",{children:"النقر على جميع الروابط والأزرار"}),e.jsx("li",{children:"التحكم الكامل كأنك في متصفح عادي"})]})]}),e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"💡 نصيحة: لفيديوهات YouTube، استخدم زر ملء الشاشة في مشغل YouTube مباشرة (يعمل بدون مشاكل)"})]})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(Cl,{className:"w-5 h-5"})," تنبيه حول سياسة الأمان (CORS)"]}),e.jsx("p",{className:"text-xs leading-relaxed opacity-70",children:"عند تشغيل روابط لمواقع ويب خارجية (مثل Google)، قد لا تظهر بعض الصفحات بسبب سياسات الأمان في المتصفح التي تمنع عرض المواقع داخل إطار (Iframe). ننصح باستخدام روابط مباشرة أو روابط تدعم الـ Embedding."})]})]}),e.jsx("button",{onClick:()=>Ve(!1),className:"mt-8 w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-black py-4 rounded-2xl transition-all shadow-xl shadow-blue-600/20 uppercase tracking-widest",children:"فهمت، لنبدأ الآن"})]})}),Kl&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-white",children:[e.jsx(is,{className:"w-6 h-6 text-purple-500"})," بحث"]}),e.jsx("button",{onClick:()=>Vt(!1),className:"text-slate-500 hover:text-white transition-colors",children:e.jsx(ze,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:ka,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>Ws("local"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${Yt==="local"?"bg-purple-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"المستودع"}),e.jsx("button",{type:"button",onClick:()=>Ws("google"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${Yt==="google"?"bg-blue-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Google"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",autoFocus:!0,value:Tt,onChange:t=>Ns(t.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg py-3 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 text-right",placeholder:Yt==="local"?"ابحث عن فيديو...":"ابحث في جوجل...",dir:"auto"}),e.jsx(is,{className:"absolute left-3 top-3.5 text-slate-500 w-5 h-5"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Vt(!1),className:"px-4 py-2 text-slate-400 hover:text-white font-medium",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white font-bold rounded-lg shadow-lg shadow-purple-900/20",children:"بحث"})]})]}),Yt==="local"&&vs.length>0&&e.jsxs("div",{className:"mt-4 max-h-60 overflow-y-auto border-t border-slate-800 pt-2",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["نتائج البحث (",vs.length,")"]}),e.jsx("div",{className:"space-y-1",children:vs.map(t=>{const s=c.find(l=>l.id===t.categoryId);return e.jsxs("button",{onClick:()=>Ca(t),className:"w-full flex items-center justify-between p-2 hover:bg-slate-800 rounded-lg group text-right",children:[e.jsxs("div",{className:"flex-1 truncate",children:[e.jsx("div",{className:"text-sm text-slate-300 group-hover:text-white truncate",children:t.title}),e.jsxs("div",{className:"text-[10px] text-slate-500 truncate flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),s?s.name:"غير مصنف"]})]}),e.jsx(tt,{className:"w-4 h-4 text-slate-600 group-hover:text-purple-400 opacity-0 group-hover:opacity-100 transition-all"})]},t.id)})})]})]})}),Ft&&e.jsx(vr,{isOpen:Ft,quickList:Oe,setQuickList:ys,playbackTarget:te,setPlaybackTarget:se,onClose:ga,settings:q,setSettings:Be,playlist:P,setPlaylist:L,setCurrentIndex:O,repository:f,categories:c,loadSavedPlaylist:Ts,savedPlaylists:R,deleteSavedPlaylist:yl,saveCurrentAsPlaylist:gl,setRepository:g,addCategory:da,renameCategory:xa,deleteCategoryRecursive:nl,clearPlaylist:hl,viewMode:Ce,setViewMode:qe,handleReorderCategories:ma,handleDeleteItems:dl,handleMoveItems:fa,handlePreviewItem:ya,handleEditVideo:Ss,setEditingVideo:It,setShowEditModal:Pt,showItemManagementModal:gs,setShowItemManagementModal:Et,initialSelectedItems:he,setInitialSelectedItems:Ye,handleCatDragStart:Is,handleCatDragOver:Ps,handleCatDrop:Es})]})},Hl=document.getElementById("root");if(!Hl)throw new Error("Could not find root element to mount to");const Pr=ar.createRoot(Hl);Pr.render(e.jsx(Te.StrictMode,{children:e.jsx(rr,{children:e.jsx(Ir,{})})}));
